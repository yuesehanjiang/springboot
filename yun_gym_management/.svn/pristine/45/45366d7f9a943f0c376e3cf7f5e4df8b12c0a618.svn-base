<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yun.mapper.UserMapper">
	
	<!-- 添加扫码用户数据 -->
    <insert id="insertUser">
        insert into user (
            open_id,
            nickname,
            img,
            create_time,
            status,
            bracelet,
            machine_code,
            channel
        ) values (
            #{openId},
            #{nickname},
            #{img},
            now(),
            #{status},
            #{bracelet},
            #{machineCode},
            #{channel}
        )
    </insert>
    
    <!-- 根据gymAddr获取机器码列表-->
    <select id="getUserByOpenId" resultType="User">
        SELECT
            *
        FROM
            user
        WHERE
            open_id = #{openId}
    </select>
    
    <!-- 修改小程序url-->
    <update id="updateUser">
        update user
        <set>
            <if test="nickname != null and nickname != ''">
                nickname = #{nickname},
            </if>
            <if test="img != null and img != ''">
                img = #{img},
            </if>
            <if test="status != null and status != ''">
                status = #{status},
            </if>
             <if test="bracelet != null and bracelet != ''">
                bracelet = #{bracelet},
            </if>
            update_time = now()
        </set>
       where open_id = #{openId}
    </update>

    <!-- 获取人脸图 -->
    <select id="getUserFaceImg" resultType="String">
        SELECT
            face_img
        FROM
            user_face
        WHERE
            open_id = #{openId}
    </select>
    
    <select id="getUserInfo" resultType="User">
         SELECT a.`img`,
		        a.`nickname`,
		        b.`face`,
		        b.`face_img` as faceImg
		 FROM USER a
		 LEFT JOIN user_face b ON a.`open_id` = b.`open_id`
		 WHERE a.`open_id` =  #{openId};
    </select>

</mapper>