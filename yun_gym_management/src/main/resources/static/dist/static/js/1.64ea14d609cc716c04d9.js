webpackJsonp([1],{"/o5o":function(e,t,i){"use strict";var a={props:{type:String,modalTitle:String,loading:Boolean,cancelText:{default:"取消",required:!1},confirmText:{default:"确认",required:!1},hiddenCancelBtn:Boolean,hiddenCancelIcon:Boolean,clickShadowButNotCancel:{default:!1}},data:function(){return{confirmLoading:!1}},methods:{clickClose:function(){this.clickShadowButNotCancel?this.$emit("clickShadow"):this.$emit("cancelModal")},clickShadow:function(){this.clickShadowButNotCancel?this.$emit("clickShadow"):this.$emit("cancelModal")},cancel:function(){this.$emit("cancelModal")},confirm:function(){var e=this;this.confirmLoading||this.$emit("confirmModal",{wait:function(){e.confirmLoading=!0},finish:function(){e.confirmLoading=!1}})}}},n={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"faded"}},[i("div",{staticClass:"modal-container",class:{"modal-warning":"warning"===e.type}},[i("div",{staticClass:"modal-shadow",on:{click:e.clickShadow}}),e._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"modal"},[i("div",{staticClass:"modal-header"},[i("h5",{staticClass:"modal-title"},[e._v(e._s(e.modalTitle))]),e._v(" "),e.hiddenCancelIcon?e._e():i("span",{staticClass:"modal-close-icon",on:{click:e.clickClose}})]),e._v(" "),i("div",{staticClass:"modal-body"},[i("div",{staticClass:"modal-content"},[e._t("default")],2),e._v(" "),i("div",{staticClass:"modal-footer"},[e.hiddenCancelBtn?e._e():i("button",{staticClass:"cancel-button",on:{click:e.cancel}},[e._v(e._s(e.cancelText))]),e._v(" "),i("button",{staticClass:"confirm-button",class:{"confirm-loading":e.confirmLoading},on:{click:e.confirm}},[e.confirmLoading?i("i",{staticClass:"el-icon-loading"}):e._e(),e._v("\n            "+e._s(e.confirmText)+"\n          ")])])])])])])},staticRenderFns:[]};var s=i("VU/8")(a,n,!1,function(e){i("s4/e")},"data-v-0dc2fdfb",null);t.a=s.exports},"0mN6":function(e,t){},H1lQ:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("uDEL"),n=i("X1cf"),s=i("y6zN"),r=i("oAV5"),o=i("E4LH"),m=i("/o5o"),c=i("R6zh"),l=(new Date).getTime(),d={components:{Breadcrumb:n.a,Modal:m.a,TimePicker:a.a},data:function(){return{isConfirming:!1,loading:!1,submitting:!1,selecting:!1,selected:[],form:{name:"",time:"",range:[]},dateOption:{disabledDate:function(e){return e.getTime()<=l-864e5}},time:"",date:"",checkedDate:[],checking:!1}},computed:{disabledDate:function(){var e=this.checkedDate,t=(new Date).getTime()-864e5,i=t+7776e6;return function(a){var n=a.getTime();return-1!==e.indexOf(r.a.formatStamp(n,"YYYY-MM-DD"))||(n>i||n<t)}},isPlaying:function(){if(this.$route.params.id&&this.status){if(0===Number(this.form.time))return!0;if(this.form.range[0]&&this.form.range[1]&&l>new Date(this.form.range[0]).getTime()&&l<new Date(this.form.range[1]).getTime())return!0}},classify:function(){return"picture"===this.$route.query.classify?"图片":"视频"},type:function(){switch(this.$route.params.type){case"top":return 0;case"middle":return 1;case"bottom":return 2}},selected_input_show:function(){var e=this.stores,t="";for(var i in e)if(e.hasOwnProperty(i)){var a=e[i];t+=a[0].storeName+": ",t+=a.map(function(e){return e.name}).join("、")+"　　"}return t},stores:function(){var e={};return this.selected.forEach(function(t){e[t.storeId]||(e[t.storeId]=[]),e[t.storeId].push(t)}),e}},watch:{"form.name":function(e){e.length>120&&this.$message({message:"文件夹名称最长120个字符",type:"warning"})},checkedDate:function(e){var t=this.date.split(","),i=!1,a=new Date(r.a.formatStamp(l,"YYYY-MM-DD")).getTime();t=t.filter(function(e){return new Date(e).getTime()>=a}),e.forEach(function(e){var a=t.indexOf(e);-1!==a&&(i=!0,t.splice(a,1))}),i&&this.$message({message:"播放日期有冲突，请重新确认",type:"warning"}),this.date=t.join(",")}},mounted:function(){var e=this;if(this.token=Object(s.b)(),this.form.user_id=this.token.id,this.$route.params.id){this.loading=!0;var t=this.$route.params.id,i=this.type,a=this.token.id;Object(c.g)({id:t,user_id:a,type:i}).then(function(t){200===Number(t.code)?(e.status=Number(t.data.status),e.form={name:t.data.folderName,time:String(t.data.unlimitedTime),range:[t.data.startTime?t.data.startTime.substr(0,t.data.startTime.length-3):"",t.data.endTime?t.data.endTime.substr(0,t.data.startTime.length-3):""]},e.time=t.data.rePlayTime.split("-").map(function(e){return e.slice(0,-3)}),e.date=t.data.rePlayDate,e.isReplay="replay"===e.$route.query.type,e.$router.replace({path:e.$route.path,query:{classify:0===Number(t.data.contentType)?"picture":"video"}}),e.checkTime2("time").catch(function(t){e.$message({message:t.message,type:"warning"})})):e.$message({message:t.message,type:"warning"}),e.loading=!1})}},methods:{handleTime:function(e){this.time=e},handleDate:function(e){this.date=e},handleTimeCheck:function(e){e||this.$nextTick(function(){var e=this,t=new Date("2018-11-11 "+this.time[0]).getTime();if(new Date("2018-11-11 "+this.time[1]).getTime()-t<72e5)return this.$message({message:"开始时间与结束时间至少间隔2小时",type:"warning"}),void this.handleTime("");this.checkTime2("time").catch(function(t){e.$message({message:t.message,type:"warning"}),e.handleTime("")})})},checkTime2:function(e){var t=this;return new Promise(function(e,i){var a={screenType:t.type,unlimited_time:t.form.time,rePlayTime:t.time[0]+":00-"+t.time[1]+":00"};t.$route.params.id&&(a.id=t.$route.params.id),a.rePlayTime?(t.checking=!0,Object(c.c)(a).then(function(a){if(t.checking=!1,200===Number(a.code)){t.checkedDate=a.data;var n=r.a.formatStamp(l,"YYYY-MM-DD"),s=new Date(n+" "+t.time[0]).getTime();l+72e5>s&&(t.$message({message:"播放的开始时间必须为当前时间的2小时后以后",type:"warning"}),t.checkedDate.push(n)),e()}else i(new Error(a.message))})):e()})},handleSelect:function(){this.isPlaying||(this.selecting=!0)},terminalConfirm:function(e){this.selected=e,this.selecting=!1},validate:function(){if(o.a.isNullString(this.form.name))return this.$message({message:"请输入文件名",type:"warning"}),!1;if(1===Number(this.form.time)){if(!this.form.range[0]||!this.form.range[1])return this.$message({message:"请选择播放时间",type:"warning"}),!1}else if(2===Number(this.form.time)){if(!this.time)return this.$message({message:"请选择播放时间范围",type:"warning"}),!1;if(!this.date)return this.$message({message:"请选择播放日期",type:"warning"}),!1}return!0},reset:function(){this.form.name="",this.isPlaying||(this.selected=[],this.form.range="",this.form.time="")},handleConfirm:function(){this.isReplay=!0,this.handleSubmit()},submit:function(){!this.submitting&&this.validate()&&(this.$route.params.id&&!this.isReplay?this.isConfirming=!0:this.handleSubmit())},handleSubmit:function(){var e=this;this.isConfirming=!1,this.submitting=!0;var t={replay:this.isReplay?1:0,userId:this.token.id,type:this.type,content_type:"picture"===this.$route.query.classify?0:1,folderName:this.form.name,roleId:Object.keys(this.stores).join(","),machine_ids:this.selected.map(function(e){return e.id}).join(","),unlimited_time:""===this.form.time?"0":this.form.time,startTime:this.form.range[0]?this.form.range[0]+":00":"",endTime:this.form.range[1]?this.form.range[1]+":00":"",rePlayTime:this.time[0]+":00-"+this.time[1]+":00",rePlayDate:this.date.split(",").map(function(e){return new Date(e).getTime()}).sort().map(function(e){return r.a.formatStamp(e,"YYYY-MM-DD")}).join(",")};if(2===Number(t.unlimited_time)){var i=t.rePlayDate.split(",");t.startTime=i[0]+" "+this.time[0]+":00",t.endTime=i[i.length-1]+" "+this.time[1]+":00"}var a=c.a;this.$route.params.id&&(a=c.n,t.id=this.$route.params.id),a(t).then(function(t){e.submitting=!1,200===Number(t.code)?(e.$message({message:"操作成功",type:"success"}),e.$route.params.id?e.$router.back():e.$router.push({path:"/screen/folder/"+t.data})):e.$message({message:t.message,type:"warning"})})}}},u={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("PageBody",[i("Breadcrumb",[i("router-link",{attrs:{tag:"li",to:"/user/screen/top"}},[e._v("三屏播放")]),e._v(" "),"top"===e.$route.params.type?i("li",[e._v("上屏")]):"middle"===e.$route.params.type?i("li",[e._v("中屏")]):"bottom"===e.$route.params.type?i("li",[e._v("下屏")]):e._e()],1),e._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"greeting-form"},[i("Form",{attrs:{"label-position":"right","label-width":124},nativeOn:{submit:function(e){e.preventDefault()},keydown:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;t.preventDefault()}}},[i("FormItem",{attrs:{label:"文件名"}},[i("Input",{staticStyle:{width:"300px"},attrs:{maxlength:119,size:"default",placeholder:"请输入文件名",disabled:e.isPlaying},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),i("FormItem",{attrs:{label:"播放时间"}},[i("Select",{staticStyle:{width:"300px"},attrs:{transfer:!1,size:"default",disabled:e.isPlaying,clearable:!e.isPlaying,placeholder:"不限时间"},model:{value:e.form.time,callback:function(t){e.$set(e.form,"time",t)},expression:"form.time"}},[i("Option",{attrs:{value:"0"}},[e._v("不限时间")]),e._v(" "),i("Option",{attrs:{value:"2"}},[e._v("设置日期")])],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:1===Number(e.form.time),expression:"Number(form.time)===1"}],staticStyle:{"margin-top":"24px"}},[i("DatePicker",{staticStyle:{width:"300px"},attrs:{type:"datetimerange",format:"yyyy-MM-dd HH:mm",size:"default",transfer:!1,editable:!1,placeholder:"请选择播放时间范围",options:e.dateOption,value:e.form.range,disabled:e.isPlaying,readonly:e.isPlaying},on:{"on-change":function(t){e.form.range=t}}}),e._v(" "),e.isPlaying?i("p",{staticStyle:{color:"#b1b1b1"}},[e._v("在播文件夹时间不可修改")]):e._e()],1),e._v(" "),2===Number(e.form.time)?[i("div",{staticStyle:{"margin-top":"24px"}},[i("TimePicker",{staticStyle:{width:"300px"},attrs:{type:"timerange",size:"default",editable:!1,clearable:!1,transfer:!1,format:"HH:mm",placeholder:"选择时间",disabled:e.isPlaying,readonly:e.isPlaying,value:e.time},on:{"on-change":e.handleTime,"on-open-change":e.handleTimeCheck}})],1),e._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.checking,expression:"checking"}],staticStyle:{"margin-top":"24px",width:"300px"}},[i("DatePicker",{staticStyle:{width:"300px"},attrs:{type:"date",size:"default",editable:!1,transfer:!1,multiple:"",placeholder:"选择日期",options:{disabledDate:e.disabledDate},disabled:e.isPlaying,readonly:e.isPlaying,value:e.date},on:{"on-change":e.handleDate}})],1),e._v(" "),e.isPlaying?i("p",{staticStyle:{color:"#b1b1b1"}},[e._v("在播文件夹时间不可修改")]):e._e()]:e._e()],2),e._v(" "),i("FormItem",[i("button",{staticClass:"form-btn",on:{click:e.reset}},[e._v("重置")]),e._v(" "),i("button",{staticClass:"form-btn primary-btn",class:{submitting:e.submitting},on:{click:e.submit}},[e._v("确定")])])],1)],1),e._v(" "),e.isConfirming?i("Modal",{attrs:{modalTitle:"复播提示",cancelText:"不复播",confirmText:"复播"},on:{cancelModal:e.handleSubmit,confirmModal:e.handleConfirm}},[e._v("是否复播该文件夹\n  ")]):e._e()],1)},staticRenderFns:[]};var h=i("VU/8")(d,u,!1,function(e){i("0mN6")},"data-v-168a03bd",null);t.default=h.exports},"s4/e":function(e,t){}});
//# sourceMappingURL=1.64ea14d609cc716c04d9.js.map