webpackJsonp([1],{"8c3L":function(e,t){},DQxn:function(e,t){},H1lQ:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("uDEL"),n=i("aZNZ"),s={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"form-title",class:{"red-title":""===this.$props.red||!!this.$props.red}},[this._t("default")],2)},staticRenderFns:[]};var r=i("VU/8")({props:["red"]},s,!1,function(e){i("sPFV")},"data-v-143472dc",null).exports,c=(i("cwe7"),i("+BTi"),i("2X9z")),o=i.n(c),l=i("J70x"),m=i("/o5o"),d={props:{message:{type:String},type:{type:String,default:"success"},duration:{type:[Number,String],default:1e3}}},h={render:function(){var e=this.$createElement,t=this._self._c||e;return t("transition",{attrs:{name:"fade"}},[t("div",{staticClass:"toast",class:this.type},[this._v("\n        "+this._s(this.message)+"\n    ")])])},staticRenderFns:[]};var u=i("VU/8")(d,h,!1,function(e){i("s2ol")},"data-v-26da155c",null).exports,f={props:{label:String,machines:Array,selected:Array},data:function(){return{isOpening:!1}},computed:{hasMachines:function(){return this.machines&&0!==this.machines.length},checked:function(){var e=this,t=0;return this.machines.forEach(function(i){-1!==e.selected.indexOf(i.id)&&t++}),0!==t},checkedAll:function(){var e=this,t=0;return this.machines.forEach(function(i){-1!==e.selected.indexOf(i.id)&&t++}),0!==t&&t===this.machines.length}},methods:{handleCheckAll:function(){var e=this;0===this.machines.length?this.dropdown():this.checkedAll||!this.checked?this.machines.forEach(function(t){e.$emit("change",t.id)}):this.machines.forEach(function(t){-1===e.selected.indexOf(t.id)&&e.$emit("change",t.id)})},handleCheck:function(e){this.$emit("change",e)},dropdown:function(){this.$refs.menu.focus(),this.isOpening=!this.isOpening},menuBlur:function(){this.isOpening=!1}}},p={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"menu",staticClass:"g-checkbox",class:{active:e.checked||e.checkedAll,"has-machines":e.hasMachines},attrs:{tabindex:"0"},on:{click:e.handleCheckAll,blur:e.menuBlur}},[i("span",{staticClass:"checkbox-box",class:{active:e.checked,activeHalf:e.checked&&!e.checkedAll}}),e._v(" "),i("span",{staticClass:"checkbox-label text-ellipsis"},[e._v(e._s(e.label))]),e._v(" "),i("div",{staticClass:"drop-down-box",on:{click:function(t){return t.stopPropagation(),e.dropdown(t)}}},[i("span",{staticClass:"drop-down"})]),e._v(" "),e.isOpening?i("ul",{staticClass:"terminal-list",on:{click:function(e){e.stopPropagation()}}},[e.hasMachines?e._l(e.machines,function(t,a){return i("li",{key:a,on:{click:function(i){i.stopPropagation(),e.handleCheck(t.id)}}},[i("span",{staticClass:"checkbox-box",class:{active:-1!==e.selected.indexOf(t.id)}}),e._v(" "),i("span",{staticClass:"text-ellipsis"},[e._v(e._s(t.name))])])}):[e._m(0)]],2):e._e()])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("li",{staticClass:"empty-li"},[t("span",[this._v("没有终端机")])])}]};var g=i("VU/8")(f,p,!1,function(e){i("DQxn")},"data-v-14a7c49a",null).exports,v=i("y6zN"),y={components:{Modal:m.a,Toast:u,GCheckbox:g},props:{createModalStatus:{type:Boolean,default:!0},type:String,selected:{type:Array,default:function(){return[]}}},data:function(){return{serverData:[],currentCityIndex:0,userSelectedIdArr:this.selected,machineLength:0}},mounted:function(){this.token=Object(v.b)(),this.stores={},this.machines={},this.getListData()},methods:{getList:function(e){var t=void 0;switch(this.type){case"screen":t=l.b;break;default:t=l.b}var i=this.params;return t(Object.assign({},e,{},i))},getListData:function(){var e=this;Promise.all([this.getList({user_id:this.token.id})]).then(function(t){if("200"===t[0].code){var i=[],a=0,n=[];t[0].data.forEach(function(t,n){var s=function(){var i=[];if(t.machines2.machine_id){for(var n=t.machines2.machine_id.split(","),s=t.machines2.machine_name.split(","),r=s.length,c=0;c<r;c++){var o={name:s[c],id:n[c],storeId:t.stores_id,storeName:t.stores_name};e.machines[n[c]]=o,i.push(o)}a+=r}return i}(),r={area_name:t.stores_city,stores_id:t.stores_id,stores_name:t.stores_name,machines:s};i.push(r)});var s={};for(var r in i.forEach(function(e){s.hasOwnProperty(e.area_name)||(s[e.area_name]={stores_city:e.area_name,children:[]}),s[e.area_name].children.push(e)}),s)n.push(s[r]);e.machineLength=a,e.serverData=n}else"201"===t[0].code&&o.a.warning({message:"您的账号下没有分配门店，请确认后再试"})})},checkboxChange:function(e){var t=this.userSelectedIdArr,i=t.indexOf(e);i>=0?t.splice(i,1):t.push(e)},handleConfirm:function(){var e=this,t=this.userSelectedIdArr.map(function(t){return e.machines[t]}).filter(function(e){return!!e});this.$emit("confirm",t)},handleCancel:function(){this.$emit("cancel")}}},b={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.serverData.length?i("modal",{staticClass:"edit-shop-modal",attrs:{"modal-title":"选择终端机 ( "+this.userSelectedIdArr.length+"/"+this.machineLength+" ) "},on:{cancelModal:e.handleCancel,confirmModal:e.handleConfirm}},[i("div",{staticClass:"modal-content-slot"},[i("ul",{staticClass:"modal-content-left"},e._l(e.serverData,function(t,a){return i("li",{key:a,staticClass:"modal-content-left-item",class:{active:a===e.currentCityIndex},on:{click:function(t){e.currentCityIndex=a}}},[e._v("\n        "+e._s(t.stores_city)+"\n      ")])})),e._v(" "),i("div",{staticClass:"modal-content-right"},e._l(e.serverData[e.currentCityIndex].children,function(t,a){return i("g-checkbox",{key:a,attrs:{machines:t.machines,label:t.stores_name,selected:e.userSelectedIdArr},on:{change:e.checkboxChange}})}))])]):e._e()},staticRenderFns:[]};var _=i("VU/8")(y,b,!1,function(e){i("8c3L")},"data-v-0f6c8ca9",null).exports,k=i("oAV5"),x=i("E4LH"),w=i("R6zh"),$=(new Date).getTime(),T={components:{Breadcrumb:n.a,FormTitle:r,SelectTerminal:_,Modal:m.a,TimePicker:a.a},data:function(){return{isConfirming:!1,loading:!1,submitting:!1,selecting:!1,selected:[],form:{name:"",time:"",range:[]},dateOption:{disabledDate:function(e){return e.getTime()<=$-864e5}},time:"",date:"",checkedDate:[],checking:!1}},computed:{disabledDate:function(){var e=this.checkedDate,t=(new Date).getTime()-864e5,i=t+7776e6;return function(a){var n=a.getTime();return-1!==e.indexOf(k.a.formatStamp(n,"YYYY-MM-DD"))||(n>i||n<t)}},isPlaying:function(){if(this.$route.params.id&&this.status){if(0===Number(this.form.time))return!0;if(this.form.range[0]&&this.form.range[1]&&$>new Date(this.form.range[0]).getTime()&&$<new Date(this.form.range[1]).getTime())return!0}},classify:function(){return"picture"===this.$route.query.classify?"图片":"视频"},type:function(){switch(this.$route.params.type){case"top":return 0;case"middle":return 1;case"bottom":return 2}},selected_input_show:function(){var e=this.stores,t="";for(var i in e)if(e.hasOwnProperty(i)){var a=e[i];t+=a[0].storeName+": ",t+=a.map(function(e){return e.name}).join("、")+"　　"}return t},stores:function(){var e={};return this.selected.forEach(function(t){e[t.storeId]||(e[t.storeId]=[]),e[t.storeId].push(t)}),e}},watch:{"form.name":function(e){e.length>120&&this.$message({message:"文件夹名称最长120个字符",type:"warning"})},checkedDate:function(e){var t=this.date.split(","),i=!1,a=new Date(k.a.formatStamp($,"YYYY-MM-DD")).getTime();t=t.filter(function(e){return new Date(e).getTime()>=a}),e.forEach(function(e){var a=t.indexOf(e);-1!==a&&(i=!0,t.splice(a,1))}),i&&this.$message({message:"播放日期有冲突，请重新确认",type:"warning"}),this.date=t.join(",")}},mounted:function(){var e=this;if(this.token=Object(v.b)(),this.form.user_id=this.token.id,this.$route.params.id){this.loading=!0;var t=this.$route.params.id,i=this.type,a=this.token.id;Object(w.g)({id:t,user_id:a,type:i}).then(function(t){200===Number(t.code)?(e.status=Number(t.data.status),e.form={name:t.data.folderName,time:String(t.data.unlimitedTime),range:[t.data.startTime?t.data.startTime.substr(0,t.data.startTime.length-3):"",t.data.endTime?t.data.endTime.substr(0,t.data.startTime.length-3):""]},e.time=t.data.rePlayTime.split("-").map(function(e){return e.slice(0,-3)}),e.date=t.data.rePlayDate,e.isReplay="replay"===e.$route.query.type,e.$router.replace({path:e.$route.path,query:{classify:0===Number(t.data.contentType)?"picture":"video"}}),e.checkTime2("time").catch(function(t){e.$message({message:t.message,type:"warning"})})):e.$message({message:t.message,type:"warning"}),e.loading=!1})}},methods:{handleTime:function(e){this.time=e},handleDate:function(e){this.date=e},handleTimeCheck:function(e){e||this.$nextTick(function(){var e=this,t=new Date("2018-11-11 "+this.time[0]).getTime();if(new Date("2018-11-11 "+this.time[1]).getTime()-t<72e5)return this.$message({message:"开始时间与结束时间至少间隔2小时",type:"warning"}),void this.handleTime("");this.checkTime2("time").catch(function(t){e.$message({message:t.message,type:"warning"}),e.handleTime("")})})},checkTime2:function(e){var t=this;return new Promise(function(e,i){var a={screenType:t.type,unlimited_time:t.form.time,rePlayTime:t.time[0]+":00-"+t.time[1]+":00"};t.$route.params.id&&(a.id=t.$route.params.id),a.rePlayTime?(t.checking=!0,Object(w.c)(a).then(function(a){if(t.checking=!1,200===Number(a.code)){t.checkedDate=a.data;var n=k.a.formatStamp($,"YYYY-MM-DD"),s=new Date(n+" "+t.time[0]).getTime();$+72e5>s&&(t.$message({message:"播放的开始时间必须为当前时间的2小时后以后",type:"warning"}),t.checkedDate.push(n)),e()}else i(new Error(a.message))})):e()})},handleSelect:function(){this.isPlaying||(this.selecting=!0)},terminalConfirm:function(e){this.selected=e,this.selecting=!1},validate:function(){if(x.a.isNullString(this.form.name))return this.$message({message:"请输入文件名",type:"warning"}),!1;if(1===Number(this.form.time)){if(!this.form.range[0]||!this.form.range[1])return this.$message({message:"请选择播放时间",type:"warning"}),!1}else if(2===Number(this.form.time)){if(!this.time)return this.$message({message:"请选择播放时间范围",type:"warning"}),!1;if(!this.date)return this.$message({message:"请选择播放日期",type:"warning"}),!1}return!0},reset:function(){this.form.name="",this.isPlaying||(this.selected=[],this.form.range="",this.form.time="")},handleConfirm:function(){this.isReplay=!0,this.handleSubmit()},submit:function(){!this.submitting&&this.validate()&&(this.$route.params.id&&!this.isReplay?this.isConfirming=!0:this.handleSubmit())},handleSubmit:function(){var e=this;this.isConfirming=!1,this.submitting=!0;var t={replay:this.isReplay?1:0,userId:this.token.id,type:this.type,content_type:"picture"===this.$route.query.classify?0:1,folderName:this.form.name,roleId:Object.keys(this.stores).join(","),machine_ids:this.selected.map(function(e){return e.id}).join(","),unlimited_time:""===this.form.time?"0":this.form.time,startTime:this.form.range[0]?this.form.range[0]+":00":"",endTime:this.form.range[1]?this.form.range[1]+":00":"",rePlayTime:this.time[0]+":00-"+this.time[1]+":00",rePlayDate:this.date.split(",").map(function(e){return new Date(e).getTime()}).sort().map(function(e){return k.a.formatStamp(e,"YYYY-MM-DD")}).join(",")};if(2===Number(t.unlimited_time)){var i=t.rePlayDate.split(",");t.startTime=i[0]+" "+this.time[0]+":00",t.endTime=i[i.length-1]+" "+this.time[1]+":00"}var a=w.a;this.$route.params.id&&(a=w.n,t.id=this.$route.params.id),a(t).then(function(t){e.submitting=!1,200===Number(t.code)?(e.$message({message:"操作成功",type:"success"}),e.$route.params.id?e.$router.back():e.$router.push({path:"/screen/folder/"+t.data})):e.$message({message:t.message,type:"warning"})})}}},C={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("PageBody",[i("Breadcrumb",[i("router-link",{attrs:{tag:"li",to:"/user/screen/top"}},[e._v("三屏播放")]),e._v(" "),"top"===e.$route.params.type?i("li",[e._v("上屏")]):"middle"===e.$route.params.type?i("li",[e._v("中屏")]):"bottom"===e.$route.params.type?i("li",[e._v("下屏")]):e._e()],1),e._v(" "),i("FormTitle",[e._v(e._s(e.$route.params.id?"编辑":"创建")+e._s(e.classify)+"文件夹")]),e._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"greeting-form"},[i("Form",{attrs:{"label-position":"right","label-width":124},nativeOn:{submit:function(e){e.preventDefault()},keydown:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;t.preventDefault()}}},[i("FormItem",{attrs:{label:"文件名"}},[i("Input",{staticStyle:{width:"300px"},attrs:{maxlength:119,size:"default",placeholder:"请输入文件名",disabled:e.isPlaying},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),i("FormItem",{attrs:{label:"播放时间"}},[i("Select",{staticStyle:{width:"300px"},attrs:{transfer:!1,size:"default",disabled:e.isPlaying,clearable:!e.isPlaying,placeholder:"不限时间"},model:{value:e.form.time,callback:function(t){e.$set(e.form,"time",t)},expression:"form.time"}},[i("Option",{attrs:{value:"0"}},[e._v("不限时间")]),e._v(" "),i("Option",{attrs:{value:"2"}},[e._v("设置日期")])],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:1===Number(e.form.time),expression:"Number(form.time)===1"}],staticStyle:{"margin-top":"24px"}},[i("DatePicker",{staticStyle:{width:"300px"},attrs:{type:"datetimerange",format:"yyyy-MM-dd HH:mm",size:"default",transfer:!1,editable:!1,placeholder:"请选择播放时间范围",options:e.dateOption,value:e.form.range,disabled:e.isPlaying,readonly:e.isPlaying},on:{"on-change":function(t){e.form.range=t}}}),e._v(" "),e.isPlaying?i("p",{staticStyle:{color:"#b1b1b1"}},[e._v("在播文件夹时间不可修改")]):e._e()],1),e._v(" "),2===Number(e.form.time)?[i("div",{staticStyle:{"margin-top":"24px"}},[i("TimePicker",{staticStyle:{width:"300px"},attrs:{type:"timerange",size:"default",editable:!1,clearable:!1,transfer:!1,format:"HH:mm",placeholder:"选择时间",disabled:e.isPlaying,readonly:e.isPlaying,value:e.time},on:{"on-change":e.handleTime,"on-open-change":e.handleTimeCheck}})],1),e._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.checking,expression:"checking"}],staticStyle:{"margin-top":"24px",width:"300px"}},[i("DatePicker",{staticStyle:{width:"300px"},attrs:{type:"date",size:"default",editable:!1,transfer:!1,multiple:"",placeholder:"选择日期",options:{disabledDate:e.disabledDate},disabled:e.isPlaying,readonly:e.isPlaying,value:e.date},on:{"on-change":e.handleDate}})],1),e._v(" "),e.isPlaying?i("p",{staticStyle:{color:"#b1b1b1"}},[e._v("在播文件夹时间不可修改")]):e._e()]:e._e()],2),e._v(" "),i("FormItem",[i("button",{staticClass:"form-btn",on:{click:e.reset}},[e._v("重置")]),e._v(" "),i("button",{staticClass:"form-btn primary-btn",class:{submitting:e.submitting},on:{click:e.submit}},[e._v("确定")])])],1)],1),e._v(" "),e.selecting?i("SelectTerminal",{attrs:{type:"screen",selected:e.selected.map(function(e){return e.id})},on:{confirm:e.terminalConfirm,cancel:function(t){e.selecting=!1}}}):e._e(),e._v(" "),e.isConfirming?i("Modal",{attrs:{modalTitle:"复播提示",cancelText:"不复播",confirmText:"复播"},on:{cancelModal:e.handleSubmit,confirmModal:e.handleConfirm}},[e._v("是否复播该文件夹\n  ")]):e._e()],1)},staticRenderFns:[]};var D=i("VU/8")(T,C,!1,function(e){i("xj1h")},"data-v-5f86fe86",null);t.default=D.exports},IyO8:function(e,t){},J70x:function(e,t,i){"use strict";t.c=function(){return Object(a.a)({method:"post",url:"/goodfield/web/admin/getMemorys",data:{}})},t.a=function(e){return Object(a.a)({method:"post",url:"/goodfield/web/user/getMachineInfo",data:e})},t.b=function(e){return Object(a.a)({method:"post",url:"/goodfield/web/folder/getstoresNameMachine",data:e})};var a=i("vLgD")},aZNZ:function(e,t,i){"use strict";var a={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"breadcrumb-container"},[t("ul",{staticClass:"breadcrumb-list"},[this._t("default")],2)])},staticRenderFns:[]};var n=i("VU/8")({data:function(){return{}},methods:{}},a,!1,function(e){i("IyO8")},"data-v-7e80aa6e",null);t.a=n.exports},s2ol:function(e,t){},sPFV:function(e,t){},xj1h:function(e,t){}});
//# sourceMappingURL=1.d727524fca6a090c9ae1.js.map