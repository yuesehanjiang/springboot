webpackJsonp([2],{"1YJn":function(e,t){},"4Z7g":function(e,t){},B2Nk:function(e,t,s){"use strict";s("cwe7"),s("+BTi");var a=s("2X9z"),n=s.n(a),i=s("S49b"),r=s("/o5o"),o=s("hNqL"),c=s("n8t0"),u=s("y6zN");function m(e){if(Array.isArray(e)){for(var t=0,s=Array(e.length);t<e.length;t++)s[t]=e[t];return s}return Array.from(e)}var l={components:{Modal:r.a,Toast:o.a,GCheckbox:c.a},props:{createModalStatus:{type:Boolean,default:!0},editUserId:[String,Number],type:String,selected:{type:Array,default:function(){return[]}}},data:function(){return{serverData:[],userSeletedIdArr:this.selected,currentCityIndex:0,allStoreLength:0,toastStatus:!1,toastData:{}}},computed:{storeChoosedLength:function(){return this.userSeletedIdArr.length}},mounted:function(){this.token=Object(u.a)(),this.stores={},this.getListData()},methods:{getListData:function(){var e=this;Promise.all([this.getStoreListByUserId({user_id:this.token.id})]).then(function(t){if("200"===t[0].code){var s=t[0].data,a=e.userSeletedIdArr,i=[],r=!0,o=!1,c=void 0;try{for(var u,l=a[Symbol.iterator]();!(r=(u=l.next()).done);r=!0){var d=u.value;i=[].concat(m(i),m(d.split(",")))}}catch(e){o=!0,c=e}finally{try{!r&&l.return&&l.return()}finally{if(o)throw c}}a=i;var h={};s.forEach(function(t,s){h.hasOwnProperty(t.stores_city)||(h[t.stores_city]={area_name:t.stores_city,stores_id:t.stores_id,stores_name:t.stores_name,children:[]});var n={area_name:t.stores_city,stores_id:t.stores_id,stores_name:t.stores_name,active:a.indexOf(t.stores_id)>=0};e.stores[t.stores_id]=n,h[t.stores_city].active=!1,h[t.stores_city].children.push(n)});var _=[],f=!0;for(var p in h)f?(f=!1,h[p].active=!0,_.push(h[p])):(h[p].active=!1,_.push(h[p]));e.allStoreLength=s.length,e.serverData=_,e.userSeletedIdArr=a}else"201"===t[0].code&&n.a.warning({message:"您的账号下没有分配门店，请确认后再试"})})},getStoreListByUserId:function(){var e=void 0;switch(this.type){case"greeting":e=i.c;break;default:e=i.b}return e({user_id:this.editUserId})},buildLists:function(){var e=this,t=[];return this.userSeletedIdArr.forEach(function(s){var a={stores_id:s,stores_name:e.stores[s].stores_name,area_name:e.stores[s].stores_city,user_id:e.editUserId};t.push(a)}),t},handleConfirm:function(){var e=this.buildLists();this.$emit("hideEditShopModal"),this.$emit("comfirmSelected",e)},changeCity:function(e){var t=this.serverData;t.forEach(function(t,s){t.active=s===e}),this.currentCityIndex=e,this.serverData=t},chooseShopItem:function(e,t,s){var a=this.userSeletedIdArr,n=a.indexOf(s);n>=0?a.splice(n,1):a.push(s);var i=this.serverData;i[e].children[t].active=!i[e].children[t].active,this.userSeletedIdArr=a,this.serverData=i},handleCancel:function(){this.$emit("hideEditShopModal")},setToastData:function(e){var t=this,s=e.message,a=e.type,n=e.callback;this.toastStatus=!0,this.$set(this.toastData,"message",s),this.$set(this.toastData,"type",a),setTimeout(function(){t.toastStatus=!1,n&&n()},1200)}}},d={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.serverData.length?s("modal",{staticClass:"edit-shop-modal",attrs:{"modal-title":"选择门店 ( "+e.storeChoosedLength+"/"+e.allStoreLength+" ) "},on:{cancelModal:e.handleCancel,confirmModal:e.handleConfirm}},[s("div",{staticClass:"modal-content-slot"},[s("ul",{staticClass:"modal-content-left"},e._l(e.serverData,function(t,a){return s("li",{key:a,staticClass:"modal-content-left-item",class:{active:t.active},on:{click:function(t){e.changeCity(a)}}},[e._v(e._s(t.area_name)+"\n      ")])})),e._v(" "),s("div",{staticClass:"modal-content-right"},e._l(e.serverData[e.currentCityIndex].children,function(t,a){return s("g-checkbox",{key:a,staticClass:"g-checkbox",attrs:{checked:t.active,label:t.stores_name},on:{change:function(s){e.chooseShopItem(e.currentCityIndex,a,t.stores_id)}}})}))]),e._v(" "),e.toastStatus?s("toast",{attrs:{message:e.toastData.message,type:e.toastData.type}}):e._e()],1):e._e()},staticRenderFns:[]};var h=s("VU/8")(l,d,!1,function(e){s("4Z7g")},"data-v-1caf0921",null);t.a=h.exports},"fw/H":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("aZNZ"),n=s("+QpU"),i=s("B2Nk"),r=s("y6zN"),o=s("E4LH"),c=s("FDGS"),u={components:{Breadcrumb:a.a,FormTitle:n.a,SelectStore:i.a},data:function(){return{loading:!1,selecting_store:!1,selected_stores:[],name_array:[],name_input:"",form:{nonmemberName:"",user_id:""},submitting:!1}},watch:{name_input:function(e,t){this.isTooLong&&(this.name_input=t,this.$message({message:"问候语最长为36个字符",type:"warning"}))},name_array:function(){this.isTooLong&&(this.name_array.pop(),this.$message({message:"问候语最长为36个字符,一个会员名称等于5个字符",type:"warning"}))}},computed:{isTooLong:function(){return(this.name_array.map(function(e){return e+"55555"}).join("")+this.name_input).length>36},name:function(){return this.name_array.map(function(e){return e+"{{name}}"}).join("")+this.name_input},stores_id:function(){return this.selected_stores.map(function(e){return e.stores_id}).join(",")}},methods:{selectedStore:function(e){this.selected_stores=e},addName:function(){(this.name_input+"55555").length>36?this.$message({message:"问候语最长为36个字符,一个会员名称等于5个字符",type:"warning"}):(this.name_array.push(this.name_input),this.name_input="",this.$refs.input&&this.$refs.input.focus())},deleteName:function(){""===this.name_input&&(this.name_input=this.name_array.pop()||"")},removeName:function(e){if(e===this.name_array.length-1){var t=this.name_array.splice(e,1);this.name_input=t+this.name_input}else this.name_array[e+1]=this.name_array[e]+this.name_array[e+1],this.name_array.splice(e,1);this.$refs.input&&this.$refs.input.focus()},validate:function(){return o.a.isNullString(this.stores_id)?(this.$message({message:"请选择适用门店",type:"warning"}),!1):!o.a.isNullString(this.name)||(this.$message({message:"会员问候语不能为空",type:"warning"}),!1)},reset:function(){this.selected_stores=[],this.name_array=[],this.name_input="",this.form.nonmemberName=""},submit:function(){var e=this;if(!this.submitting&&this.validate()){this.submitting=!0;var t={name:this.name,stores_id:this.stores_id,nonmemberName:this.form.nonmemberName,user_id:this.form.user_id},s=c.b;this.$route.params.id&&(s=c.i,t.id=this.$route.params.id),s(t).then(function(t){e.submitting=!1,200===Number(t.code)?(e.$message({message:t.message,type:"success"}),e.$router.back()):e.$message({message:t.message,type:"warning"})})}}},mounted:function(){var e=this,t=Object(r.a)();if(this.form.user_id=t.id,this.$route.params.id){this.loading=!0;var s=this.$route.params.id,a=t.id;Object(c.g)({id:s,userId:a}).then(function(t){200===Number(t.code)?(e.selected_stores=t.data.roles,e.name_array=t.data.name.split("{{name}}"),e.name_input=e.name_array.pop(),e.form.nonmemberName=t.data.nonmemberName):e.$message({message:t.message,type:"warning"}),e.loading=!1})}}},m={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("Breadcrumb",[s("router-link",{attrs:{tag:"li",to:"/user/greetings/common"}},[e._v("问候语")]),e._v(" "),s("li",[e._v("通用问候语")])],1),e._v(" "),s("FormTitle",[e._v(e._s(e.$route.params.id?"编辑":"添加")+"问候语")]),e._v(" "),s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"greeting-form"},[s("Form",{attrs:{"label-position":"right","label-width":124},nativeOn:{submit:function(e){e.preventDefault()},keydown:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;t.preventDefault()}}},[s("FormItem",{attrs:{label:"适用门店"}},[s("div",{on:{click:function(t){e.selecting_store=!0}}},[s("Input",{attrs:{value:e.selected_stores.map(function(e){return e.stores_name}).join("    "),size:"default",placeholder:"点击选择门店",readonly:""}}),e._v(" "),s("div",{staticClass:"edit-store"},[s("i",{staticClass:"edit-store-icon"})])],1)]),e._v(" "),s("FormItem",{attrs:{label:"会员问候语"}},[s("div",{staticClass:"greeting-input"},[s("ul",{staticClass:"greeting-box"},[e._l(e.name_array,function(t,a){return[s("li",{key:"i"+a},[e._v(e._s(t))]),e._v(" "),s("li",{key:"n"+a,staticClass:"write-member"},[s("span",[e._v("会员名")]),e._v(" "),s("i",{staticClass:"remove-member",on:{click:function(t){e.removeName(a)}}})])]}),e._v(" "),s("li",{staticClass:"write-input",class:{"input-writing":""!==e.name}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.name_input,expression:"name_input"}],ref:"input",attrs:{type:"text",placeholder:""===e.name?"请输入问候语，字数上限36字符（含中、英文及特殊符号等）":""},domProps:{value:e.name_input},on:{keydown:function(t){return"button"in t||!e._k(t.keyCode,"delete",[8,46],t.key,["Backspace","Delete"])?e.deleteName(t):null},input:function(t){t.target.composing||(e.name_input=t.target.value)}},nativeOn:{submit:function(e){e.preventDefault()}}})])],2)]),e._v(" "),s("span",{staticClass:"add-name",on:{click:e.addName}},[e._v("+ 添加会员名")])]),e._v(" "),s("FormItem",[s("button",{staticClass:"form-btn",on:{click:e.reset}},[e._v("重置")]),e._v(" "),s("button",{staticClass:"form-btn primary-btn",class:{submitting:e.submitting},on:{click:e.submit}},[e._v("确定")])])],1)],1),e._v(" "),e.selecting_store?s("SelectStore",{attrs:{type:"greeting",editUserId:this.form.user_id,selected:e.selected_stores.map(function(e){return e.stores_id})},on:{comfirmSelected:e.selectedStore,hideEditShopModal:function(t){e.selecting_store=!1}}}):e._e()],1)},staticRenderFns:[]};var l=s("VU/8")(u,m,!1,function(e){s("1YJn"),s("w06h")},"data-v-5181afbb",null);t.default=l.exports},w06h:function(e,t){}});
//# sourceMappingURL=2.960692ea72a5cac23569.js.map