webpackJsonp([28],{mLNd:function(e,t){},pGaZ:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("SJI6"),i=s("R6zh"),n=s("y6zN"),r=s("oAV5"),o=s.n(r),c=s("/o5o"),l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},d={components:{Modal:c.a},data:function(){return{isWarning:!1,isConfirming:!1,isLoading:!1,isEmpty:!1,isNoPower:!1,canSpread:!1,isSpread:!1,idNeedSpread:[],listData:{},spreadFolder:[]}},computed:{tableData:function(){if(Array.isArray(this.listData.data)){var e={};this.listData.machineCount.forEach(function(t){e[t.folder_id]||(e[t.folder_id]=[]),e[t.folder_id].push(t)});var t=[];return this.listData.data.forEach(function(s){var a={},i=s.stores_name.split(","),n=s.stores_id.split(","),r=s.machine_name_all.split(","),o=s.machine_id_all.split(","),c=s.machine_ids.split(","),l=s.machine_name.split(","),d=c.map(function(e,t){return{id:e,name:l[t]}});e[s.id]&&e[s.id].forEach(function(e){var t=d.map(function(e){return e.id}).indexOf(e.machine_id);-1!==t&&d.splice(t,1)});var u=void 0,p=0;n.forEach(function(e,n){if(-1!==d.map(function(e){return e.name?e.name.split("-")[0]:""}).indexOf(i[n])){p++,u=u||e;var r={storeName:i[n],storeId:e,folderId:s.id,folderName:s.folderName,unlimited_time:s.unlimited_time,status:s.status,startTime:s.startTime,endTime:s.endTime,rePlayDate:s.rePlayDate,rePlayTime:s.rePlayTime,table_index:s.index,machines:[],checked_machine_ids:d.map(function(e){return e.id}).join(","),index:p-1};a[e]=r,t.push(r)}}),u?(a[u].spanSign=p>3?p+1:p,p>3&&t.push({machines:[],more:!0,folderId:s.id,index:-1}),r.forEach(function(e,t){var s=e.split("-")[0],r=n[i.indexOf(s)];a[r]&&a[r].machines.push({machineName:e,machineId:o[t],storeName:s,storeId:r})})):t.push({machines:[],spanSign:1,empty:!0,folderId:s.id,folderName:s.folderName,unlimited_time:s.unlimited_time,status:s.status,startTime:s.startTime,endTime:s.endTime,table_index:s.index,index:1})}),t}},type:function(){switch(this.$route.params.type){case"top":return 0;case"middle":return 1;case"bottom":return 2}},content_type:function(){switch(this.$route.query.classify){case"picture":return 0;case"video":return 1}}},watch:{$route:function(){this.getList(Object.assign({},this.$route.query))}},beforeCreate:function(){var e=this.$route.query,t=e.classify,s=e.pageNum,a=e.pageSize;"picture"!==t&&"video"!==t&&Object.is(s,void 0)&&Object.is(a,void 0)&&this.$router.replace({path:this.$route.path,query:{classify:"picture",pageNum:0,pageSize:10}})},mounted:function(){var e=this;this.token=Object(n.a)(),this.getList(Object.assign({},this.$route.query)),window.onresize=o.a.throttle(function(){e.checkSpread()},1e3);var t=setInterval(function(){!1!==e.checkSpread()&&clearInterval(t)},500);this.$store.state.userMenuStatus&&this.$store.state.userMenuStatus.screen&&(Object(i.b)({user_id:this.token.id}),this.setUserMenuStatus(Object.assign({},this.$store.state.userMenuStatus,{screen:!1})))},destroyed:function(){window.onresize=null},methods:l({},Object(a.mapMutations)({setUserMenuStatus:"SET_USER_MENU_STATUS"}),{handleName:function(e){return e.length>13?e.substr(0,13)+"...":e},handleDelete:function(e){e.empty?(this.folderEmpty=1,this.isConfirming=e.folderId):1!==Number(e.status)&&(this.isConfirming=e.folderId)},handleConfirm:function(){var e=this;Object(i.f)({empty:this.folderEmpty,user_id:this.token.id,id:this.isConfirming,type:this.type}).then(function(t){200===Number(t.code)?(e.$message({message:"删除成功",type:"success"}),e.isConfirming=!1,e.getList(Object.assign({},e.$route.query))):e.$message({message:t.message,type:"warning"})})},changeStatus:function(e){var t=this;if(1===Number(e.status)){var s={id:e.folderId,user_id:this.token.id,type:this.type,status:"0"===String(e.status)?"1":"0"};Object(i.n)(s).then(function(s){200===Number(s.code)?(t.$message({message:"修改成功，已"+("0"===String(e.status)?"播放":"停播")+"文件夹",type:"success"}),t.getList(Object.assign({},t.$route.query))):t.$message({message:s.message,type:"warning"})})}else this.$router.push({path:this.$route.params.type+"/detail/"+e.folderId,query:{type:"replay"}})},headerClick:function(e){"machines"===e.property&&this.canSpread&&(this.isSpread=!this.isSpread)},cellClick:function(e){if(e.more){var t=e.folderId,s=this.spreadFolder.indexOf(t);-1===s?this.spreadFolder.push(t):this.spreadFolder.splice(s,1)}},checkSpread:function(){var e=this;if(!this.isSpread){var t=Object.keys(this.$refs).filter(function(t){return"ul"===t.split("-")[0]&&e.$refs[t]}),s=t.map(function(t){return e.$refs[t]});if(0===s.length)return!1;if(s.map(function(e){return e.offsetHeight}).some(function(e){return 40!==e})){this.canSpread=s.map(function(e){return Array.prototype.slice.call(e.childNodes).reduce(function(e,t){return e+t.offsetWidth+40},0)}).reduce(function(e,t){return e>t?e:t});var a=t.map(function(e){return e.split("-")[1]}),i=[];s.forEach(function(e,t){40!==e.offsetHeight&&i.push(a[t])}),this.idNeedSpread=i}else this.canSpread=!1}},arraySpanMethod:function(e){var t=e.row,s=(e.column,e.rowIndex,e.columnIndex);return 2!==s&&3!==s?t.spanSign?{rowspan:t.spanSign,colspan:1}:{rowspan:0,colspan:0}:t.more?{rowspan:2===s?1:0,colspan:2===s?2:0}:-1===this.spreadFolder.indexOf(t.folderId)&&t.index>2?{rowspan:0,colspan:0}:void 0},easyQuery:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.$route.query,s=Object.assign({},t,e);this.$router.push({path:this.$route.path,query:s})},handleClassify:function(e){this.easyQuery({pageNum:0,classify:e})},getList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isLoading=!0,t.user_id=this.token.id,t.type=this.type,t.content_type=this.content_type,delete t.classify,t.pageNum=t.pageNum||0,t.pageSize=t.pageSize||10,this.listData.data=null,Object(i.j)(t).then(function(t){200===Number(t.code)?(e.isEmpty=!1,e.listData=e.countIndex(t)):201===Number(t.code)?e.isEmpty=!0:202===Number(t.code)?e.isNoPower=!0:e.$message({message:t.message,type:"warning"}),e.isLoading=!1})},countIndex:function(e){var t=e.pageSize,s=e.pageNum;return e.data.forEach(function(e,a){e.index=t*s+a+1}),e},pageNumChange:function(e){this.easyQuery({pageNum:String(e-1)})},pageSizeChange:function(e){this.easyQuery({pageNum:String(0),pageSize:e})}})},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"screen-container"},[a("div",{staticClass:"screen-btn-group"},[a("button",{staticClass:"screen-btn",class:{"screen-primary":0===e.content_type},on:{click:function(t){e.handleClassify("picture")}}},[e._v("\n      图片\n    ")]),e._v(" "),"bottom"!==e.$route.params.type?a("button",{staticClass:"screen-btn",class:{"screen-primary":1===e.content_type},on:{click:function(t){e.handleClassify("video")}}},[e._v("\n      视频\n    ")]):e._e()]),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"screen-body"},[e.isNoPower?e._e():a("div",{staticClass:"btn-group"},[e._m(0),e._v(" "),a("router-link",{staticClass:"add-btn",attrs:{tag:"button",to:{path:e.$route.params.type+"/detail",query:{classify:this.$route.query.classify}}}},[e._v("\n        创建文件夹\n      ")])],1),e._v(" "),e.isEmpty?a("div",{staticClass:"screen-empty"},[a("img",{attrs:{src:s("9Xu7"),alt:"empty_logo"}}),e._v(" "),a("p",{staticClass:"empty-title"},[e._v("还没有文件，请先\n        "),a("router-link",{attrs:{to:{path:e.$route.params.type+"/detail",query:{classify:this.$route.query.classify}}}},[e._v("\n          创建文件夹\n        ")])],1)]):e.isNoPower?a("div",{staticClass:"screen-empty"},[a("img",{attrs:{src:s("9Xu7"),alt:"empty_logo"}}),e._v(" "),a("p",{staticClass:"empty-title"},[e._v("没有模块权限，请与管理员确认")])]):[a("div",{staticClass:"screen-body-container list-container",class:{"can-spread":e.canSpread,"is-spread":e.isSpread}},[a("el-table",{staticStyle:{"text-align":"center",color:"#666666"},attrs:{"header-cell-style":{"text-align":"center"},height:"100%",data:e.tableData,"span-method":e.arraySpanMethod,border:"","header-cell-class-name":function(e){return 3===e.columnIndex&&"spread-btn"}},on:{"header-click":e.headerClick,"cell-click":e.cellClick}},[a("el-table-column",{attrs:{prop:"table_index",width:"68",label:"序号"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.table_index))]),e._v(" "),1===Number(t.row.status)?a("i",{staticClass:"playing-icon"}):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"folderName",width:"120",label:"文件夹"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.empty?[a("span",{staticStyle:{color:"rgb(177, 177, 177)"}},[e._v(e._s(e.handleName(t.row.folderName)))])]:[a("router-link",{staticClass:"folder-link",attrs:{tag:"span",title:t.row.folderName,to:"folder/"+t.row.folderId}},[e._v(e._s(e.handleName(t.row.folderName))+"\n                ")])]]}}])}),e._v(" "),a("el-table-column",{attrs:{width:"158",prop:"storeName",label:"门店"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.empty?[a("span",{staticStyle:{color:"#B1B1B1"}},[e._v("-/-")])]:e._e(),e._v(" "),t.row.more?[a("div",{staticStyle:{color:"#217EE6",cursor:"pointer"}},[e._v("\n                  "+e._s(-1===e.spreadFolder.indexOf(t.row.folderId)?"更多":"收起")+"\n                ")])]:[e._v(e._s(t.row.storeName))]]}}])}),e._v(" "),a("el-table-column",{attrs:{"min-width":e.canSpread&&e.isSpread?e.canSpread:400,prop:"machines",label:"选择终端机"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.empty?a("div",[a("span",{staticStyle:{color:"#B1B1B1"}},[e._v("终端机的本地文件被删除，文件夹失效")])]):0===t.row.machines.length?a("div",[a("span",{staticStyle:{color:"#B1B1B1"}},[e._v("请选择终端机")])]):a("div",{staticClass:"checkbox-list checkbox-readonly",class:{"need-spread":e.canSpread&&!e.isSpread&&-1!==e.idNeedSpread.indexOf(t.row.folderId+"+"+t.row.storeId)}},[a("ul",{ref:"ul-"+t.row.folderId+"+"+t.row.storeId,staticClass:"checkbox-ul"},e._l(t.row.machines,function(s,i){return a("li",{key:i},[a("el-checkbox",{attrs:{disabled:"",checked:-1!==t.row.checked_machine_ids.indexOf(s.machineId)}},[e._v("\n                      "+e._s(s.machineName)+"\n                    ")])],1)}))])]}}])}),e._v(" "),a("el-table-column",{attrs:{width:"314px",label:"播放时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{"font-size":"12px"}},[0===Number(t.row.unlimited_time)?[e._v("\n                  不限时间\n                ")]:1===Number(t.row.unlimited_time)?[a("span",[e._v(e._s(t.row.startTime))]),e._v(" "),a("span",{staticStyle:{margin:"0 14px"}},[e._v("至")]),e._v(" "),a("span",[e._v(e._s(t.row.endTime))])]:2===Number(t.row.unlimited_time)?[a("div",{staticClass:"selected-time-container"},[a("span",[e._v(e._s(t.row.rePlayTime.split("-").map(function(e){return e.slice(0,-3)}).join("-")))]),e._v(" "),a("span",{staticClass:"selected-time-tips"},[e._v("已选日期")])]),e._v(" "),a("DatePicker",{staticClass:"selected-time-picker",attrs:{type:"date",size:"default",editable:!1,transfer:!1,clearable:!1,multiple:"",confirm:!1,value:t.row.rePlayDate}})]:e._e()],2)]}}])}),e._v(" "),a("el-table-column",{attrs:{width:"185",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.empty?[a("span",{staticClass:"operate-btn",on:{click:function(s){e.handleDelete(t.row)}}},[e._v("删除")])]:[a("span",{staticClass:"operate-btn",on:{click:function(s){e.changeStatus(t.row)}}},[e._v("\n                "+e._s(1===Number(t.row.status)?"停播":"复播")+"\n              ")]),e._v(" "),1===Number(t.row.status)?[a("Poptip",{staticClass:"tip-box",attrs:{trigger:"hover",width:"240",transfer:!1,placement:"bottom-end"}},[a("span",{staticClass:"operate-btn disable-del"},[e._v("编辑")]),e._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("ul",{staticClass:"tips-container"},[a("li",[e._v("在播文件夹信息不能编辑与删除")]),e._v(" "),a("li",[e._v("若需要编辑或删除，请先停播文件夹")])])])]),e._v(" "),a("Poptip",{staticClass:"tip-box",attrs:{trigger:"hover",width:"240",transfer:!1,placement:"bottom-end"}},[a("span",{staticClass:"operate-btn disable-del"},[e._v("删除")]),e._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("ul",{staticClass:"tips-container"},[a("li",[e._v("在播文件夹信息不能编辑与删除")]),e._v(" "),a("li",[e._v("若需要编辑或删除，请先停播文件夹")])])])])]:[a("router-link",{staticClass:"operate-btn",attrs:{tag:"span",to:e.$route.params.type+"/detail/"+t.row.folderId}},[e._v("编辑\n                  ")]),e._v(" "),a("span",{staticClass:"operate-btn",on:{click:function(s){e.handleDelete(t.row)}}},[e._v("删除")])]]]}}])})],1)],1),e._v(" "),a("div",{staticClass:"screen-body-footer"},[a("Page",{attrs:{total:Number(e.listData.total),current:Number(e.listData.pageNum)+1,"page-size":Number(e.listData.pageSize),"show-sizer":"","show-elevator":"","show-total":"",transfer:!1},on:{"on-change":e.pageNumChange,"on-page-size-change":e.pageSizeChange}})],1)]],2),e._v(" "),e.isConfirming?a("Modal",{attrs:{modalTitle:"删除"},on:{cancelModal:function(t){e.isConfirming=!1},confirmModal:e.handleConfirm}},[e._v("确认删除吗\n  ")]):e._e(),e._v(" "),e.isWarning?a("Modal",{attrs:{type:"warning",hiddenCancelBtn:!0,modalTitle:"存储空间不足",confirmText:"立即处理",clickShadowButNotCancel:!0},on:{confirmModal:function(t){e.isWarning=!1}}},[a("i",{staticClass:"modal-error-icon"}),e._v(" "),a("span",[e._v("系统空间不足！请清除过期文件夹，否则系统将自动清除！")])]):e._e()],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("p",{staticClass:"btn-group-left"},[t("span",{staticClass:"help-icon"}),this._v(" "),t("span",{staticClass:"operation-tips"},[this._v("点击文件夹名称，可上传文件")])])}]};var p=s("VU/8")(d,u,!1,function(e){s("mLNd")},"data-v-73c4e68b",null);t.default=p.exports}});
//# sourceMappingURL=28.b7ce42d095d4291385e0.js.map