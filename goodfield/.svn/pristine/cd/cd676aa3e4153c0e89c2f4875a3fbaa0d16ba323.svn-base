webpackJsonp([14],{"52CY":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("Pfph"),s=a("SJI6"),o=a("oAV5"),n=a.n(o),l=a("/o5o"),r=a("hNqL"),c=a("cMGX"),d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},u={components:{Modal:l.a,Toast:r.a,GPagination:c.a},data:function(){return{listData:[],loading:!0,paganition:{},keyword:this.$route.query.keyword,allChoosed:!1,createModalStatus:!1,deleteModalStatus:!1,userSelected:[],freezedUserSelected:[],isEdited:!1,quitStatus:!1,toastStatus:!1,toastData:{}}},watch:{$route:function(){this.getListData(this.$route.query)}},beforeCreate:function(){var e=this.$route.query,t=e.pageNum,a=e.pageSize,i=e.keyword;Object.is(t,void 0)&&Object.is(a,void 0)&&Object.is(i,void 0)&&this.$router.replace({path:this.$route.path,query:{pageNum:"0",pageSize:"10",keyword:""}})},mounted:function(){this.getListData(this.$route.query)},beforeRouteLeave:function(e,t,a){("/login"===e.path&&a(),this.quitStatus)?a():this.isAdminEditedAuth()?(this.deleteModalStatus=!0,a(!1)):a()},methods:d({easyQuery:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.$route.query,a=Object.assign({},t,e);this.$router.push({path:this.$route.path,query:a})},changeCurrentPage:function(e){var t=e.pageNum;this.easyQuery({pageNum:t})},changeCurrentSize:function(e){var t=e.pageSize;this.easyQuery({pageNum:"0",pageSize:t})},inputContent:n.a.throttle(function(){this.easyQuery({keyword:this.keyword,pageNum:0})},1e3,{leading:!1}),isAdminEditedAuth:function(){var e=this.userSelected,t=this.freezedUserSelected,a=e.length,i=!1;if(a!==t.length)i=!0;else for(var s=0;s<a;s++){var o=e[s];if(t.indexOf(o)<0){i=!0;break}}return this.isEdited=i,i},clickShadow:function(){this.deleteModalStatus=!1},quit:function(){this.quitStatus=!0,this.$router.push({path:"/admin/auth/list"})},confirmSave:function(){this.quitStatus=!0,this.confirm()},changeElCheckBox:function(e){var t=this.userSelected,a=t.indexOf(e);a>-1?t.splice(a,1):t.push(e),this.userSelected=t,this.setAllChoose(),this.isAdminEditedAuth()},getListData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=!0;var a=Object.assign({user_id:this.$route.params.userId},t);Object(i.a)(a).then(function(t){var a=[{relid:1,checked:!1,title:"入场人数统计"},{relid:2,checked:!1,title:"自定义问候语"},{relid:3,checked:!1,title:"会员管理"},{relid:4,checked:!1,title:"入场报告"},{relid:5,checked:!1,title:"稽核报告"},{relid:6,checked:!1,title:"三屏资讯管理"}];if("200"===t.code){var i=t.data,s=[];e.allChoosed=!0;var o=[],n=[];i.forEach(function(e,t){var i={storeId:e.stores_id,storeName:e.stores_name};a.forEach(function(t,a){i["relation"+a]={relid:a+1,storeName:t.title,active:!1},e.relations.length&&e.relations.forEach(function(s,l){parseInt(s.relid)===t.relid&&(i["relation"+a].active=!0,o.push(e.stores_id+"-relid"+s.relid),n.push(e.stores_id+"-relid"+s.relid))})}),s.push(i)}),e.paganition={total:Number(t.total),pageSize:Number(t.pageSize),currentPage:Number(t.pageNum)+1},e.freezedUserSelected=n,e.userSelected=o,e.tempListData=JSON.stringify(s),e.listData=s,e.setAllChoose()}else"201"===t.code?e.listData=[]:(e.listData=[],e.setToastData({message:t.message,type:"fail"}));e.loading=!1})},setAllChoose:function(){var e=!0;this.listData.length?this.listData.forEach(function(t){for(var a=0;a<6;a++)t["relation"+a].active||(e=!1)}):this.allChoosed=!1,this.allChoosed=e},chooseAll:function(){var e=this;this.allChoosed=!this.allChoosed;var t=[],a=this.listData;a.forEach(function(a){for(var i in a)i.indexOf("relation")>-1&&(e.allChoosed&&t.push(a.storeId+"-relid"+a[i].relid),a[i].active=e.allChoosed)}),this.userSelected=t,this.listData=a,this.isAdminEditedAuth()},cancel:function(){this.isEdited&&(this.listData=JSON.parse(this.tempListData),this.userSelected=JSON.parse(JSON.stringify(this.freezedUserSelected)),this.isEdited=!1,this.setAllChoose())},buildLists:function(){var e=this,t=[];return this.listData.forEach(function(a){for(var i in a)if(i.indexOf("relation")>-1)if(a[i].active){var s={user_id:e.$route.params.userId,stores_id:a.storeId,relationId:a[i].relid};t.push(s)}else{var o={user_id:e.$route.params.userId,stores_id:a.storeId,relationId:""};t.push(o)}}),t},confirm:function(){var e=this;if(this.isEdited){var t={lists:this.buildLists()};Object(i.c)(t).then(function(t){"200"===t.code?e.setToastData({message:t.message,callback:function(){e.isEdited=!1,e.getListData(e.$route.query)}}):e.setToastData({message:t.message,type:"fail"})})}},setToastData:function(e){var t=this,a=e.message,i=e.type,s=e.callback;this.toastStatus=!0,this.$set(this.toastData,"message",a),this.$set(this.toastData,"type",i),setTimeout(function(){t.toastStatus=!1,s&&s()},1200)}},Object(s.mapMutations)({setCurrentEditUser:"SET_CURRENT_EDIT_USER"}))},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"list"},[a("div",{ref:"listHeader",staticClass:"list-header"},[a("h3",{staticClass:"list-title"},[a("router-link",{staticClass:"auth-link",attrs:{to:"/admin/auth/list"}},[e._v("权限管理")]),e._v(" "),a("span",{staticClass:"icon"}),e._v(" "),a("span",{staticClass:"small"},[e._v("设置权限")])],1),e._v(" "),a("div",{staticClass:"list-header-right"},[a("el-input",{staticStyle:{width:"360px","margin-right":"40px"},attrs:{placeholder:"搜索门店","prefix-icon":"el-icon-search",clearable:!0},on:{input:e.inputContent},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),e._v(" "),a("div",{staticClass:"modal-footer"},[a("span",{staticClass:"cancel-button",class:{active:e.isEdited},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),a("span",{class:e.isEdited?"confirm-button":"cancel-button",on:{click:e.confirm}},[e._v("确定")])]),e._v(" "),a("div",{staticClass:"add-container"},[a("span",{staticClass:"add-icon",class:{active:e.allChoosed},on:{click:e.chooseAll}}),e._v(" "),a("span",{staticClass:"add-text",on:{click:e.chooseAll}},[e._v(e._s(e.allChoosed?"取消全选":"全选权限"))])])],1)]),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"table-footer"},[a("el-table",{staticStyle:{width:"100%"},attrs:{type:"index",data:e.listData,border:""}},[a("el-table-column",{attrs:{prop:"storeName",label:"门店",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"relation0",align:"center",label:"入场人数统计"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{staticClass:"el-checkbox-item",on:{change:function(a){e.changeElCheckBox(t.row.storeId+"-relid1")}},model:{value:t.row.relation0.active,callback:function(a){e.$set(t.row.relation0,"active",a)},expression:"scope.row.relation0.active"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"relation1",align:"center",label:"自定义问候语"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{staticClass:"el-checkbox-item",on:{change:function(a){e.changeElCheckBox(t.row.storeId+"-relid2")}},model:{value:t.row.relation1.active,callback:function(a){e.$set(t.row.relation1,"active",a)},expression:"scope.row.relation1.active"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"relation2",align:"center",label:"会员管理"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{staticClass:"el-checkbox-item",on:{change:function(a){e.changeElCheckBox(t.row.storeId+"-relid3")}},model:{value:t.row.relation2.active,callback:function(a){e.$set(t.row.relation2,"active",a)},expression:"scope.row.relation2.active"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"relation3",align:"center",label:"入场报告"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{staticClass:"el-checkbox-item",on:{change:function(a){e.changeElCheckBox(t.row.storeId+"-relid4")}},model:{value:t.row.relation3.active,callback:function(a){e.$set(t.row.relation3,"active",a)},expression:"scope.row.relation3.active"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"relation4",align:"center",label:"稽核报告"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{staticClass:"el-checkbox-item",on:{change:function(a){e.changeElCheckBox(t.row.storeId+"-relid5")}},model:{value:t.row.relation4.active,callback:function(a){e.$set(t.row.relation4,"active",a)},expression:"scope.row.relation4.active"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"relation5",align:"center",label:"三屏播放管理"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{staticClass:"el-checkbox-item",on:{change:function(a){e.changeElCheckBox(t.row.storeId+"-relid6")}},model:{value:t.row.relation5.active,callback:function(a){e.$set(t.row.relation5,"active",a)},expression:"scope.row.relation5.active"}})]}}])})],1),e._v(" "),e.listData.length?a("g-pagination",{attrs:{total:e.paganition.total,"page-size":e.paganition.pageSize,"current-page":e.paganition.currentPage},on:{changeCurrentPage:e.changeCurrentPage,changeCurrentSize:e.changeCurrentSize}}):e._e()],1),e._v(" "),e.deleteModalStatus?a("modal",{attrs:{"click-shadow-but-not-cancel":!0,"modal-title":"温馨提示","cancel-text":"退出","confirm-text":"保存设置"},on:{clickShadow:e.clickShadow,cancelModal:e.quit,confirmModal:e.confirmSave}},[e._v("\n    新设置未保存，是否确定退出？\n  ")]):e._e(),e._v(" "),e.toastStatus?a("toast",{attrs:{message:e.toastData.message,type:e.toastData.type}}):e._e()],1)},staticRenderFns:[]};var f=a("VU/8")(u,h,!1,function(e){a("ck16"),a("z8LN")},"data-v-110444a1",null);t.default=f.exports},Pfph:function(e,t,a){"use strict";t.b=function(e){return Object(i.a)({method:"post",url:"/goodfield/web/admin/listUserRoleRelationsInfo",data:e})},t.a=function(e){return Object(i.a)({method:"post",url:"/goodfield/web/admin/getUserRoleRelationInfo",data:e})},t.c=function(e){return Object(i.a)({method:"post",url:"/goodfield/web/admin/addUserRoleRelation",data:e})};var i=a("vLgD")},ck16:function(e,t){},z8LN:function(e,t){}});
//# sourceMappingURL=14.835a85d58fbb6b9b6736.js.map