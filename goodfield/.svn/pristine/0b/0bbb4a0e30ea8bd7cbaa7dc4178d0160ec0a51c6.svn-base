webpackJsonp([20],{OUsg:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("J70x"),s=a("y6zN"),i=a("oAV5"),r=a.n(i),o=a("/o5o"),l=a("hNqL"),c=a("cMGX");function u(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}var p={components:{Modal:o.a,Toast:l.a,GPagination:c.a},data:function(){var t=this.$route.query;return{status:t.status,keyword:t.keyword,listData:[],loading:!0,machineTotalLabel:"总数量",paganition:{},toastStatus:!1,toastData:{},statusOptions:[{status:"",label:"全部"},{status:"1",label:"在线"},{status:"0",label:"离线"}]}},watch:{$route:function(){var t=this.$route.query,e=t.pageNum,a=t.pageSize;void 0===e||void 0===a?this.easyQuery({pageNum:0,pageSize:10,status:"",keyword:""}):this.getListData(this.$route.query)},status:function(){this.easyQuery({pageNum:0,status:this.status})}},beforeCreate:function(){var t=this.$route.query,e=t.status,a=t.keyword,n=t.pageSize,s=t.pageNum;Object.is(n,void 0)&&Object.is(s,void 0)&&Object.is(e,void 0)&&Object.is(a,void 0)&&this.$router.replace({path:this.$route.path,query:{pageNum:0,pageSize:10,status:"",keyword:""}})},mounted:function(){this.getMemorys(),this.getListData(this.$route.query)},methods:{getMemorys:function(){var t=this;Object(n.e)().then(function(e){t.memory=e.data}).catch(function(){t.loading=!1})},handleMemory:function(t){for(var e=this.memory,a=e.length,n=0;n<a;n++)if(e[n].machine_id===t){var s=e[n].memory.split(",");return{top:s[0],cenBottom:s[1]}}},easyQuery:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.$route.query,a=Object.assign({},e,t);this.$router.push({path:this.$route.path,query:a})},changeCurrentPage:function(t){var e=t.pageNum;this.easyQuery({pageNum:e})},changeCurrentSize:function(t){var e=t.pageSize;this.easyQuery({pageNum:"0",pageSize:e})},refreshData:function(){this.getMemorys(),this.getListData(this.$route.query)},inputContent:r.a.throttle(function(){this.easyQuery({keyword:this.keyword,pageNum:0})},1e3,{leading:!1}),getListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=!0;var a=Object.assign({account:Object(s.a)().account},e);Object(n.c)(a).then(function(e){"200"===e.code?(t.listData=t.handleListData1(e.data),t.machineTotalLabel="总数量",t.paganition={pageSize:parseInt(e.pageSize),currentPage:parseInt(e.pageNum)+1,total:parseInt(e.total)}):"201"===e.code?(t.listData=[],t.machineTotalLabel="总数量"):(t.listData=[],t.machineTotalLabel="总数量",t.setToastData({message:e.message,type:"fail"})),t.loading=!1}).catch(function(){t.loading=!1})},handleListData1:function(t){for(var e=[],a=0;a<t.length;a++)for(var n=t[a],s=n.machine_id.split(","),i=n.status.split(","),r=n.machine_name.split(","),o=s.length,l=!0,c=this.$route.query,p=c.pageSize,h=c.pageNum,d=0;d<o;d++){var g={index:p*h+a+1,userId:n.id,cityName:n.stores_city,storeId:n.stores_id,storeName:n.stores_name,freeStorage:this.handleMemory(s[d]),frequency:parseInt(n.frequency),machineId:s[d],machineName:r[d],machineStatus:parseInt(i[d])};l?(l=!1,g.span1=Number(n.frequency)):g.span1=0,e.push(g)}var m={},f=[];e.forEach(function(t,e){var a=f.indexOf(t.cityName)+"";if("-1"===a){var n;f.push(t.cityName),n=f.length-1+"",m[n]=[],m[n].push(t)}else m[a].push(t)});var v=[],y=function(t){var e=m[t].length,a=!0;m[t].forEach(function(n){a?(a=!1,n.span=e):n.span=0,n.total=m[t][0].span}),v=[].concat(u(v),u(m[t]))};for(var b in m)y(b);return v},setToastData:function(t){var e=this,a=t.message,n=t.type,s=t.callback;this.toastStatus=!0,this.$set(this.toastData,"message",a),this.$set(this.toastData,"type",n),setTimeout(function(){e.toastStatus=!1,s&&s()},1200)},objectSpanMethod1:function(t){var e=t.row,a=(t.column,t.rowIndex,t.columnIndex);return a<2||7===a?e.span>1?{rowspan:e.span,colspan:1}:0===e.span?{rowspan:0,colspan:0}:{rowspan:1,colspan:1}:2===a||6===a?e.span1>1?{rowspan:e.span1,colspan:1}:0===e.span1?{rowspan:0,colspan:0}:{rowspan:1,colspan:1}:{rowspan:1,colspan:1}}}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"list list-special"},[a("div",{staticClass:"list-header frsbc"},[a("div",{staticClass:"list-header-left"},[a("div",{staticClass:"list-header-select-container"},[a("el-select",{attrs:{placeholder:"状态"},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},t._l(t.statusOptions,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.status}})}))],1),t._v(" "),a("div",{staticClass:"list-header-input-container"},[a("el-input",{staticStyle:{width:"350px"},attrs:{placeholder:"可搜索门店名","prefix-icon":"el-icon-search"},nativeOn:{input:function(e){return t.inputContent(e)}},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1)]),t._v(" "),t._m(0)]),t._v(" "),a("div",{staticClass:"terminal-table-container"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.listData,"span-method":t.objectSpanMethod1,border:""}},[a("el-table-column",{attrs:{prop:"index",label:"序号",align:"center",width:"60"}}),t._v(" "),a("el-table-column",{attrs:{prop:"cityName",align:"center",label:"地区"}}),t._v(" "),a("el-table-column",{attrs:{prop:"storeName",align:"center",label:"门店"}}),t._v(" "),a("el-table-column",{attrs:{prop:"machineName",align:"center",label:"终端机"}}),t._v(" "),a("el-table-column",{attrs:{prop:"machineStatus",align:"center",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("span",{staticClass:"status-radius online",class:{outline:!t.row.machineStatus}})]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"freeStorage",align:"center",label:"内存余量（GB）"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[a("span",{class:{red:Number(e.row.freeStorage.top)<.48}},[t._v("上屏:"+t._s(e.row.freeStorage.top)+"；")]),t._v(" "),a("span",{class:{red:Number(e.row.freeStorage.cenBottom)<.48}},[t._v("中下屏:"+t._s(e.row.freeStorage.cenBottom))])])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"frequency",align:"center",label:"数量"}}),t._v(" "),a("el-table-column",{attrs:{prop:"total",align:"center",label:t.machineTotalLabel}})],1)],1),t._v(" "),t.listData.length?a("g-pagination",{attrs:{total:t.paganition.total,"page-size":t.paganition.pageSize,"current-page":t.paganition.currentPage},on:{changeCurrentPage:t.changeCurrentPage,changeCurrentSize:t.changeCurrentSize}}):t._e(),t._v(" "),t.toastStatus?a("toast",{attrs:{message:t.toastData.message,type:t.toastData.type}}):t._e()],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"list-header-right"},[e("div",[e("span",{staticClass:"online-icon"}),this._v("\n        在线\n      ")]),this._v(" "),e("div",[e("span",{staticClass:"outline-icon"}),this._v("\n        离线\n      ")])])}]};var d=a("VU/8")(p,h,!1,function(t){a("tn2z"),a("pnvT")},"data-v-1d4bd26f",null);e.default=d.exports},pnvT:function(t,e){},tn2z:function(t,e){}});
//# sourceMappingURL=20.d688324d1e25940c6a32.js.map