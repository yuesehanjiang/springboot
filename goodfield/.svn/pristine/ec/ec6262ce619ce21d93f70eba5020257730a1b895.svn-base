webpackJsonp([10],{"+bKq":function(t,e){},IbYX:function(t,e){},Pfph:function(t,e,a){"use strict";e.b=function(t){return Object(s.a)({method:"post",url:"/goodfield/web/admin/listUserRoleRelationsInfo",data:t})},e.a=function(t){return Object(s.a)({method:"post",url:"/goodfield/web/admin/getUserRoleRelationInfo",data:t})},e.c=function(t){return Object(s.a)({method:"post",url:"/goodfield/web/admin/addUserRoleRelation",data:t})};var s=a("vLgD")},vF38:function(t,e){},vwDV:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("Pfph"),i=a("SJI6"),n=a("oAV5"),r=a.n(n),o=a("/o5o"),c=a("S49b"),d=a("hNqL"),l=a("n8t0");var u={components:{Modal:o.a,Toast:d.a,GCheckbox:l.a},props:{createModalStatus:{type:Boolean,default:!0},editUserId:[String,Number]},data:function(){return{serverData:[],userSeletedIdArr:[],currentCityIndex:0,allStoreLength:0,toastStatus:!1,toastData:{}}},computed:{storeChoosedLength:function(){return this.userSeletedIdArr.length},currentChildrenAllChoosed:function(){for(var t=!0,e=this.serverData[this.currentCityIndex].children,a=e.length,s=0;s<a;s++)if(!e[s].active){t=!1;break}return t}},mounted:function(){this.getListData()},methods:{getListData:function(){var t=this;Promise.all([this.getStoreListByUserId(),this.getStoreList()]).then(function(e){if(("200"===e[0].code||"201"===e[0].code)&&"200"===e[1].code){var a="201"===e[0].code?[]:e[0].data,s=e[1].data,i=[],n=[];a.forEach(function(t,e){i.push(t.stores_id),n.push(t.stores_id)});var r={};s.forEach(function(t,a){r.hasOwnProperty(t.stores_city)||(r[t.stores_city]={title:t.stores_city,children:[]}),r[t.stores_city].children.push({stores_id:t.stores_id,stores_name:t.stores_name,active:"201"!==e[0].code&&i.indexOf(t.stores_id)>=0}),r[t.stores_city].active=!1});var o=[],c=!0;for(var d in r)c?(c=!1,r[d].active=!0,o.push(r[d])):(r[d].active=!1,o.push(r[d]));t.allStoreLength=s.length,t.serverData=o,t.userInitialSeletedIdArr=n,t.userSeletedIdArr=i,t.allSelectedIdArr=i}})},getStoreListByUserId:function(){return Object(c.b)({user_id:this.editUserId})},getStoreList:function(){return Object(c.a)({})},buildLists:function(){var t=this,e=this.userSeletedIdArr,a=[];return e.length?e.forEach(function(e){var s={stores_id:e,user_id:t.editUserId};a.push(s)}):a=[{user_id:this.editUserId,stores_id:""}],a},clickChoosedAll:function(){var t=this.serverData,e=this.userSeletedIdArr,a=this.serverData[this.currentCityIndex].children,s=a.length,i=[];if(this.currentChildrenAllChoosed)for(var n=0;n<s;n++){a[n].active=!1;var r=e.indexOf(a[n].stores_id);r>-1&&e.splice(r,1)}else for(var o=0;o<s;o++)a[o].active||(i.push(a[o].stores_id),a[o].active=!0);this.userSeletedIdArr=[].concat(function(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}(e),i),this.serverData=t},compareInitialAndCurrent:function(){var t=this.userInitialSeletedIdArr,e=t.length,a=this.userSeletedIdArr,s=!0;if(e!==a.length)s=!1;else{for(var i=0,n=0;n<e;n++)for(var r=0;r<e;r++)t[n]===a[r]&&i++;s=i===e}return s},handleConfirm:function(){var t=this;if(this.compareInitialAndCurrent())this.handleCancel();else{var e=this.buildLists();Object(c.d)({lists:e}).then(function(e){"200"===e.code?(t.$message({message:e.message,type:"success"}),t.handleCancel(),t.$emit("updateUserStoreSuccess")):t.$message({message:e.message,type:"error"})})}},changeCity:function(t){var e=this.serverData;e.forEach(function(e,a){e.active=a===t}),this.currentCityIndex=t,this.serverData=e},chooseShopItem:function(t,e,a){var s=this.userSeletedIdArr,i=s.indexOf(a);i>=0?s.splice(i,1):s.push(a);var n=this.serverData;n[t].children[e].active=!n[t].children[e].active,this.userSeletedIdArr=s,this.serverData=n},handleCancel:function(){this.$emit("hideEditShopModal")},setToastData:function(t){var e=this,a=t.message,s=t.type,i=t.callback;this.toastStatus=!0,this.$set(this.toastData,"message",a),this.$set(this.toastData,"type",s),setTimeout(function(){e.toastStatus=!1,i&&i()},1200)}}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.serverData.length?a("modal",{staticClass:"edit-shop-modal",attrs:{"modal-title":"选择门店 ( "+t.storeChoosedLength+"/"+t.allStoreLength+" ) "},on:{cancelModal:t.handleCancel,confirmModal:t.handleConfirm}},[a("div",{staticClass:"modal-content-slot"},[a("ul",{staticClass:"modal-content-left"},t._l(t.serverData,function(e,s){return a("li",{key:s,staticClass:"modal-content-left-item",class:{active:e.active},on:{click:function(e){t.changeCity(s)}}},[t._v(t._s(e.title))])})),t._v(" "),a("div",[a("div",{staticClass:"shop-operation",on:{click:t.clickChoosedAll}},[a("span",{staticClass:"allchoosed-icon",class:{active:t.currentChildrenAllChoosed}}),t._v(" "),a("span",{staticClass:"allchoosed-text"},[t._v("全选")])]),t._v(" "),a("div",{staticClass:"modal-content-right"},t._l(t.serverData[t.currentCityIndex].children,function(e,s){return a("g-checkbox",{key:s,staticClass:"g-checkbox",attrs:{checked:e.active,label:e.stores_name},on:{change:function(a){t.chooseShopItem(t.currentCityIndex,s,e.stores_id)}}})}))])]),t._v(" "),t.toastStatus?a("toast",{attrs:{message:t.toastData.message,type:t.toastData.type}}):t._e()],1):t._e()},staticRenderFns:[]};var p=a("VU/8")(u,h,!1,function(t){a("vF38")},"data-v-29af69d5",null).exports,f=a("cMGX"),v=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(t[s]=a[s])}return t},g={components:{EditShop:p,Modal:o.a,Toast:d.a,GPagination:f.a},data:function(){return{keyword:this.$route.query.keyword,specialListData:[],listData:[],paganition:{},loading:!0,toastStatus:!1,toastData:{},editUserId:0,editShopModalStatus:!1,editAuthStatus:!1,editAuthUserId:0,authWidth:"410",authExpanded:!1,accountStatus:!0,phoneStatus:!0}},computed:{tableThClassName:function(){return this.authExpanded?"auth-table-th-td active":"auth-table-th-td"},hasMatchKeywordListData:function(){return!!(this.keyword.length&&this.listData.length<=0)}},watch:{$route:function(){var t=this.$route.query,e=t.pageNum,a=t.pageSize,s=t.keyword;Object.is(e,void 0)&&Object.is(a,void 0)&&Object.is(s,void 0)?this.$router.replace({path:this.$route.path,query:{pageNum:0,pageSize:10,keyword:""}}):this.getListData(this.$route.query)}},beforeCreate:function(){var t=this.$route.query,e=t.pageNum,a=t.pageSize,s=t.keyword;Object.is(e,void 0)&&Object.is(a,void 0)&&Object.is(s,void 0)&&this.$router.replace({path:this.$route.path,query:{pageNum:0,pageSize:10,keyword:""}})},mounted:function(){this.getListData(this.$route.query)},methods:v({easyQuery:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.$route.query,a=Object.assign({},e,t);this.$router.push({path:this.$route.path,query:a})},changeCurrentPage:function(t){var e=t.pageNum;this.easyQuery({pageNum:e})},changeCurrentSize:function(t){var e=t.pageSize;this.easyQuery({pageNum:0,pageSize:e})},inputContent:r.a.throttle(function(){this.easyQuery({keyword:this.keyword,pageNum:0})},1e3,{leading:!1}),getListData:function(t){var e=this;Object(s.b)(t).then(function(t){"200"===t.code?(e.listData=e.handleListData(t),e.specialListData=e.handleSpecialListData(t),e.paganition={pageSize:parseInt(t.pageSize),currentPage:parseInt(t.pageNum)+1,total:parseInt(t.total)}):"201"===t.code?e.listData=[]:"201"!==t.code&&(e.listData=[],e.setToastData({message:t.message,type:"fail"})),e.loading=!1}).catch(function(){e.loading=!1})},getDefaultAuthList:function(){return[{relid:1,checked:!1,title:"入场人数统计"},{relid:2,checked:!1,title:"自定义问候语"},{relid:3,checked:!1,title:"会员管理"},{relid:4,checked:!1,title:"入场报告"},{relid:5,checked:!1,title:"稽核报告"},{relid:6,checked:!1,title:"三屏播放管理"}]},handleListData:function(t){for(var e=this,a=t.data,s=t.pageSize,i=t.pageNum,n=a.length,r=[],o=0;o<n;o++){var c=a[o],d=c.roles.length;if(d)for(var l=!0,u=function(t){var a=e.getDefaultAuthList(),n=c.roles[t],u={};u.id=c.id,u.username=c.username,u.account=c.account,u.phone=c.phone,u.storeId=n.stores_id,u.storeName=n.stores_name,u.authList=a,u.row=0,u.canEditAuth=1,u.isMoreTag=0,u.index=s*i+o+1,l?(l=!1,u.span=d):u.span=0,u.authList.forEach(function(t){n.relations.forEach(function(e){t.relid===e.relid&&(t.checked=!0)})}),r.push(u)},h=0;h<d;h++)u(h);else{var p={};p.id=c.id,p.username=c.username,p.account=c.account,p.phone=c.phone,p.storeId=0,p.storeName="- / -",p.authList=[],p.span=1,p.canEditAuth=0,p.index=s*i+o+1,r.push(p)}}return r},handleSpecialListData:function(t){for(var e=t.data,a=t.pageSize,s=t.pageNum,i=e.length,n=[],r=0;r<i;r++){var o=e[r],c=o.roles.length;if(c){c>2&&(c=3);for(var d=!0,l=function(t){var e={},i=o.roles[t];t===c-1&&0!==t&&c>2?(e.id=o.id,e.username=o.username,e.account=o.account,e.phone=o.phone,e.storeId=0,e.storeName="更多",e.authList=[],e.span=0,e.row=2,e.isMoreTag=1,e.canEditAuth=1,e.index=a*s+r+1):(e.id=o.id,e.username=o.username,e.account=o.account,e.phone=o.phone,e.storeId=i.stores_id,e.storeName=i.stores_name,e.authList=[{relid:1,checked:!1,title:"入场人数统计"},{relid:2,checked:!1,title:"自定义问候语"},{relid:3,checked:!1,title:"会员管理"},{relid:4,checked:!1,title:"入场报告"},{relid:5,checked:!1,title:"稽核报告"},{relid:6,checked:!1,title:"三屏播放管理"}],e.isMoreTag=0,e.row=0,e.canEditAuth=1,e.index=a*s+r+1,d?(d=!1,e.span=c):e.span=0,e.authList.forEach(function(t){i.relations.forEach(function(e){t.relid===e.relid&&(t.checked=!0)})})),n.push(e)},u=0;u<c;u++)l(u)}else{var h={};h.id=o.id,h.username=o.username,h.account=o.account,h.phone=o.phone,h.storeId=0,h.storeName="- / -",h.authList=[],h.span=1,h.canEditAuth=0,h.isMoreTag=0,h.index=a*s+r+1,n.push(h)}}return n},expandMore:function(t){var e=this.listData,a=this.specialListData,s=[],i=[],n=[];e.forEach(function(e){e.id===t&&(0!==e.span&&(e.span+=1),i.push(e))});var r=i.length;i[0].span=r+1;var o=-1;a.forEach(function(e,a){-1===o&&e.id===t?o=a:-1===o&&e.id!==t?s.push(e):-1!==o&&e.id!==t&&n.push(e)});var c={id:t,username:"",account:"",phone:"",storeId:0,storeName:"收起",authList:[],span:0,row:2,isMoreTag:2};i.push(c),this.specialListData=[].concat(s,i,n)},closeMore:function(t){for(var e=this.listData,a=this.specialListData,s=[],i=[],n=[],r=e.length,o=0;o<r;o++){var c=e[o];if(2===i.length)break;c.id===t&&(0!==c.span&&(c.span=3),i.push(c))}var d=-1;a.forEach(function(e,a){-1===d&&e.id===t?d=a:-1===d&&e.id!==t?s.push(e):-1!==d&&e.id!==t&&n.push(e)});var l={id:t,username:"",account:"",phone:"",storeId:0,storeName:"更多",authList:[],span:0,row:2,isMoreTag:1};i.push(l),this.specialListData=[].concat(s,i,n)},setToastData:function(t){var e=this,a=t.message,s=t.type,i=t.callback;this.toastStatus=!0,this.$set(this.toastData,"message",a),this.$set(this.toastData,"type",s),setTimeout(function(){e.toastStatus=!1,i&&i()},1200)},showEditShopModal:function(t){this.editUserId=t,this.editShopModalStatus=!0},hideEditShopModal:function(){this.editShopModalStatus=!1},showEditAuth:function(t,e){e?(this.editAuthUserId=t,this.$router.push({path:"/admin/auth/list/edit_auth/"+t})):this.setToastData({message:"请先编辑门店",type:"fail"})},hideEditAuth:function(){this.editAuthStatus=!1},selectAuth:function(t,e){"authList"===t.property&&(this.authExpanded?(this.authExpanded=!1,this.accountStatus=!0,this.phoneStatus=!0,this.authWidth="360"):(this.authExpanded=!0,this.accountStatus=!1,this.phoneStatus=!1,this.authWidth="760"))},navigateToUserList:function(){this.$router.push({path:"/admin/user_list"})},objectSpanMethod:function(t){var e=t.row,a=(t.column,t.rowIndex,t.columnIndex),s=4,i=6,n=4;return this.authExpanded&&(s=2,i=4,n=2),a<s||a===i?e.span>1?{rowspan:e.span,colspan:1}:0===e.span?{rowspan:0,colspan:0}:{rowspan:1,colspan:1}:a===n||a===n+1?e.row>1?{rowspan:1,colspan:e.row}:(e.row,{rowspan:1,colspan:1}):void 0}},Object(i.mapMutations)({setCurrentEditUser:"SET_CURRENT_EDIT_USER"}))},m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"list"},[a("div",{ref:"listHeader",staticClass:"list-header"},[a("h3",{staticClass:"list-title"},[t._v("权限管理")]),t._v(" "),a("div",{staticClass:"add-container"},[a("el-input",{staticStyle:{width:"360px"},attrs:{placeholder:"可搜索用户名、登录账号、绑定手机","prefix-icon":"el-icon-search"},on:{input:t.inputContent},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1)]),t._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[t.listData.length?a("div",{staticClass:"auth-table-container"},[t.editAuthStatus?t._e():a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.specialListData,size:"large",border:"","span-method":t.objectSpanMethod},on:{"header-click":t.selectAuth}},[a("el-table-column",{attrs:{prop:"index",fixed:"",width:"60",label:"序号",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"username",align:"center",fixed:"",label:"用户姓名"}}),t._v(" "),t.accountStatus?a("el-table-column",{ref:"account",attrs:{prop:"account",align:"center",label:"登录账号"}}):t._e(),t._v(" "),t.phoneStatus?a("el-table-column",{ref:"phone",attrs:{prop:"phone",align:"center",label:"绑定手机号码"}}):t._e(),t._v(" "),a("el-table-column",{ref:"store",attrs:{prop:"storeName",type:"index",width:"170",align:"center",label:"门店"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.isMoreTag?a("p",{staticClass:"more-tag",on:{click:function(a){t.expandMore(e.row.id)}}},[t._v(t._s(e.row.storeName))]):2===e.row.isMoreTag?a("p",{staticClass:"more-tag",on:{click:function(a){t.closeMore(e.row.id)}}},[t._v(t._s(e.row.storeName))]):a("p",[t._v(t._s(e.row.storeName))])]}}])}),t._v(" "),a("el-table-column",{ref:"authTableTh",attrs:{"class-name":t.tableThClassName,prop:"authList",align:"center",width:t.authWidth,label:"选择权限"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"select-auth-td-content"},[e.row.storeId?a("div",[t._l(e.row.authList,function(e,s){return t.authExpanded||s<2?a("div",{key:e.relid,staticClass:"el-checkbox-container",staticStyle:{display:"inline-block"}},[a("el-checkbox",{attrs:{disabled:""},model:{value:e.checked,callback:function(a){t.$set(e,"checked",a)},expression:"item.checked"}},[t._v("\n                    "+t._s(e.title)+"\n                  ")])],1):t._e()}),t._v(" "),t.authExpanded?t._e():a("span",{staticClass:"ellipsis"},[t._v("......")])],2):a("p",{staticClass:"edit-shop-tips"},[t._v("请编辑门店")])])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"operation",fixed:"right",align:"center",width:"160",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"operation-text-button",on:{click:function(a){t.showEditShopModal(e.row.id)}}},[t._v("编辑门店")]),t._v(" "),a("span",{staticClass:"operation-text-button",on:{click:function(a){t.showEditAuth(e.row.id,e.row.canEditAuth)}}},[t._v("设置权限")])]}}])})],1)],1):t._e()]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.loading&&!t.listData.length,expression:"!loading && !listData.length"}],staticClass:"no-data-container"},[a("div",[t.hasMatchKeywordListData?t._e():a("div",{staticClass:"gray-logo"}),t._v(" "),t.hasMatchKeywordListData?a("p",{staticClass:"no-data-tips"},[t._v("没有匹配的数据，请修改筛选关键词")]):a("p",{staticClass:"no-data-tips"},[a("span",[t._v("还没有用户，请去")]),t._v(" "),a("span",{staticClass:"special-text",on:{click:t.navigateToUserList}},[t._v("创建用户")])])])]),t._v(" "),t.specialListData.length?a("g-pagination",{attrs:{total:t.paganition.total,"page-size":t.paganition.pageSize,"current-page":t.paganition.currentPage},on:{changeCurrentPage:t.changeCurrentPage,changeCurrentSize:t.changeCurrentSize}}):t._e(),t._v(" "),t.editShopModalStatus?a("edit-shop",{attrs:{editUserId:t.editUserId},on:{updateUserStoreSuccess:function(e){t.getListData(t.$route.query)},hideEditShopModal:t.hideEditShopModal}}):t._e(),t._v(" "),t.toastStatus?a("toast",{attrs:{message:t.toastData.message,type:t.toastData.type}}):t._e()],1)},staticRenderFns:[]};var _=a("VU/8")(g,m,!1,function(t){a("+bKq"),a("IbYX")},"data-v-84ab78f8",null);e.default=_.exports}});
//# sourceMappingURL=10.179a51233ae60f31a463.js.map