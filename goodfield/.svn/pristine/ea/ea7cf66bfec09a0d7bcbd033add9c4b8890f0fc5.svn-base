webpackJsonp([8],{"4Z7g":function(t,e){},B2Nk:function(t,e,a){"use strict";a("cwe7"),a("+BTi");var s=a("2X9z"),n=a.n(s),i=a("S49b"),r=a("/o5o"),o=a("hNqL"),u=a("n8t0"),c=a("y6zN");function m(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}var l={components:{Modal:r.a,Toast:o.a,GCheckbox:u.a},props:{createModalStatus:{type:Boolean,default:!0},editUserId:[String,Number],type:String,selected:{type:Array,default:function(){return[]}}},data:function(){return{serverData:[],userSeletedIdArr:this.selected,currentCityIndex:0,allStoreLength:0,toastStatus:!1,toastData:{}}},computed:{storeChoosedLength:function(){return this.userSeletedIdArr.length}},mounted:function(){this.token=Object(c.a)(),this.stores={},this.getListData()},methods:{getListData:function(){var t=this;Promise.all([this.getStoreListByUserId({user_id:this.token.id})]).then(function(e){if("200"===e[0].code){var a=e[0].data,s=t.userSeletedIdArr,i=[],r=!0,o=!1,u=void 0;try{for(var c,l=s[Symbol.iterator]();!(r=(c=l.next()).done);r=!0){var d=c.value;i=[].concat(m(i),m(d.split(",")))}}catch(t){o=!0,u=t}finally{try{!r&&l.return&&l.return()}finally{if(o)throw u}}s=i;var h={};a.forEach(function(e,a){h.hasOwnProperty(e.stores_city)||(h[e.stores_city]={area_name:e.stores_city,stores_id:e.stores_id,stores_name:e.stores_name,children:[]});var n={area_name:e.stores_city,stores_id:e.stores_id,stores_name:e.stores_name,active:s.indexOf(e.stores_id)>=0};t.stores[e.stores_id]=n,h[e.stores_city].active=!1,h[e.stores_city].children.push(n)});var _=[],v=!0;for(var f in h)v?(v=!1,h[f].active=!0,_.push(h[f])):(h[f].active=!1,_.push(h[f]));t.allStoreLength=a.length,t.serverData=_,t.userSeletedIdArr=s}else"201"===e[0].code&&n.a.warning({message:"您的账号下没有分配门店，请确认后再试"})})},getStoreListByUserId:function(){var t=void 0;switch(this.type){case"greeting":t=i.c;break;default:t=i.b}return t({user_id:this.editUserId})},buildLists:function(){var t=this,e=[];return this.userSeletedIdArr.forEach(function(a){var s={stores_id:a,stores_name:t.stores[a].stores_name,area_name:t.stores[a].stores_city,user_id:t.editUserId};e.push(s)}),e},handleConfirm:function(){var t=this.buildLists();this.$emit("hideEditShopModal"),this.$emit("comfirmSelected",t)},changeCity:function(t){var e=this.serverData;e.forEach(function(e,a){e.active=a===t}),this.currentCityIndex=t,this.serverData=e},chooseShopItem:function(t,e,a){var s=this.userSeletedIdArr,n=s.indexOf(a);n>=0?s.splice(n,1):s.push(a);var i=this.serverData;i[t].children[e].active=!i[t].children[e].active,this.userSeletedIdArr=s,this.serverData=i},handleCancel:function(){this.$emit("hideEditShopModal")},setToastData:function(t){var e=this,a=t.message,s=t.type,n=t.callback;this.toastStatus=!0,this.$set(this.toastData,"message",a),this.$set(this.toastData,"type",s),setTimeout(function(){e.toastStatus=!1,n&&n()},1200)}}},d={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.serverData.length?a("modal",{staticClass:"edit-shop-modal",attrs:{"modal-title":"选择门店 ( "+t.storeChoosedLength+"/"+t.allStoreLength+" ) "},on:{cancelModal:t.handleCancel,confirmModal:t.handleConfirm}},[a("div",{staticClass:"modal-content-slot"},[a("ul",{staticClass:"modal-content-left"},t._l(t.serverData,function(e,s){return a("li",{key:s,staticClass:"modal-content-left-item",class:{active:e.active},on:{click:function(e){t.changeCity(s)}}},[t._v(t._s(e.area_name)+"\n      ")])})),t._v(" "),a("div",{staticClass:"modal-content-right"},t._l(t.serverData[t.currentCityIndex].children,function(e,s){return a("g-checkbox",{key:s,staticClass:"g-checkbox",attrs:{checked:e.active,label:e.stores_name},on:{change:function(a){t.chooseShopItem(t.currentCityIndex,s,e.stores_id)}}})}))]),t._v(" "),t.toastStatus?a("toast",{attrs:{message:t.toastData.message,type:t.toastData.type}}):t._e()],1):t._e()},staticRenderFns:[]};var h=a("VU/8")(l,d,!1,function(t){a("4Z7g")},"data-v-1caf0921",null);e.a=h.exports},Luoc:function(t,e){},vPLq:function(t,e){},wgtA:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("aZNZ"),n=a("+QpU"),i=a("B2Nk"),r=a("y6zN"),o=a("E4LH"),u=a("FDGS"),c={components:{Breadcrumb:s.a,FormTitle:n.a,SelectStore:i.a},data:function(){return{loading:!1,name_array:[],name_input:"",form:{user_id:""},submitting:!1,user_name:""}},watch:{name_input:function(t,e){this.isTooLong&&(this.name_input=e,this.$message({message:"专属问候语最长为36个字符",type:"warning"}))},name_array:function(){this.isTooLong&&(this.name_array.pop(),this.$message({message:"专属问候语最长为36个字符",type:"warning"}))}},computed:{isTooLong:function(){var t=this;return(this.name_array.map(function(e){return e+t.user_name}).join("")+this.name_input).length>36},name:function(){var t=this;return this.name_array.map(function(e){return e+t.user_name}).join("")+this.name_input}},methods:{addName:function(){(this.name_input+this.user_name).length>36?this.$message({message:"专属问候语最长为36个字符",type:"warning"}):(this.name_array.push(this.name_input),this.name_input="",this.$refs.input&&this.$refs.input.focus())},deleteName:function(){""===this.name_input&&(this.name_input=this.name_array.pop()||"")},removeName:function(t){if(t===this.name_array.length-1){var e=this.name_array.splice(t,1);this.name_input=e+this.name_input}else this.name_array[t+1]=this.name_array[t]+this.name_array[t+1],this.name_array.splice(t,1);this.$refs.input&&this.$refs.input.focus()},validate:function(){return!o.a.isNullString(this.name)||(this.$message({message:"会员问候语不能为空",type:"warning"}),!1)},reset:function(){this.name_array=[],this.name_input=""},submit:function(){var t=this;if(!this.submitting&&this.validate()){this.submitting=!0;var e={exclusive:this.name,user_id:this.token.id,id:this.$route.query.user_id},a=u.a;a(e).then(function(e){t.submitting=!1,200===Number(e.code)?(t.$message({message:e.message,type:"success"}),t.$router.back()):t.$message({message:e.message,type:"warning"})})}}},mounted:function(){var t=this,e=Object(r.a)();if(this.token=e,this.form.user_id=e.id,this.$route.params.id){this.loading=!0;var a=this.$route.params.id;Object(u.e)({id:a,user_id:this.$route.query.user_id}).then(function(e){200===Number(e.code)?(t.user_name=e.data.user_name,t.name_array=e.data.exclusive.split(t.user_name),t.name_input=t.name_array.pop()):"201"!==e.code&&t.$message({message:e.message,type:"warning"}),t.loading=!1}).catch(function(){t.loading=!1})}}},m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Breadcrumb",[a("router-link",{attrs:{tag:"li",to:"/user/greetings/custom"}},[t._v("问候语")]),t._v(" "),a("li",[t._v("专属问候语")])],1),t._v(" "),a("FormTitle",[t._v("设置问候语")]),t._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"greeting-form"},[a("Form",{attrs:{"label-position":"right","label-width":124},nativeOn:{submit:function(t){t.preventDefault()},keydown:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.preventDefault()}}},[a("FormItem",{attrs:{label:"会员问候语"}},[a("div",{staticClass:"greeting-input"},[a("ul",{staticClass:"greeting-box"},[t._l(t.name_array,function(e,s){return[a("li",{key:"i"+s},[t._v(t._s(e))]),t._v(" "),a("li",{key:"n"+s,staticClass:"write-member"},[a("span",[t._v(t._s(t.user_name))]),t._v(" "),a("i",{staticClass:"remove-member",on:{click:function(e){t.removeName(s)}}})])]}),t._v(" "),a("li",{staticClass:"write-input",class:{"input-writing":""!==t.name}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.name_input,expression:"name_input"}],ref:"input",attrs:{type:"text",placeholder:""===t.name?"请输入问候语，字数上限36字符（含中、英文及特殊符号等）":""},domProps:{value:t.name_input},on:{keydown:function(e){return"button"in e||!t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete"])?t.deleteName(e):null},input:function(e){e.target.composing||(t.name_input=e.target.value)}},nativeOn:{submit:function(t){t.preventDefault()}}})])],2)]),t._v(" "),a("span",{staticClass:"add-name",on:{click:t.addName}},[t._v("+ 添加会员名")])]),t._v(" "),a("FormItem",[a("button",{staticClass:"form-btn",on:{click:t.reset}},[t._v("重置")]),t._v(" "),a("button",{staticClass:"form-btn primary-btn",class:{submitting:t.submitting},on:{click:t.submit}},[t._v("确定")])])],1)],1)],1)},staticRenderFns:[]};var l=a("VU/8")(c,m,!1,function(t){a("Luoc"),a("vPLq")},"data-v-1788ddb6",null);e.default=l.exports}});
//# sourceMappingURL=8.1c9a7fd9d22961121a5b.js.map