webpackJsonp([19],{"5gEi":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("J70x"),s=a("oAV5"),r=a.n(s),i=a("/o5o"),o=a("hNqL"),l=a("cMGX"),c=a("7Gg6");function u(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}var p={components:{Modal:i.a,Toast:o.a,GPagination:l.a,Breadcrumb:c.a},data:function(){var t=this.$route.query;return{tabIndex:0,tabs:[{title:"已分发"},{title:"未分发"}],status:t.status,originData:null,keyword:t.keyword,memory:[],listData:[],newListData:[],loading:!0,machineTotalLabel:"总数量",paganition:{},toastStatus:!1,toastData:{},statusOptions:[{status:"",label:"全部"},{status:"1",label:"在线"},{status:"0",label:"离线"}]}},computed:{searchPlaceholder:function(){return this.tabIndex?"可搜索门店":"可搜索用户名、登录账号、绑定手机"}},watch:{$route:function(){var t=this.$route.query,e=t.pageNum,a=t.pageSize,n=t.status;void 0===e||void 0===a||void 0===n?this.easyQuery({pageNum:0,pageSize:10,status:""}):this.getListData(this.$route.query)},tabIndex:function(t,e){var a=this.$route.query,n=a.pageNum,s=a.keyword;0===Number(n)&&""===s?this.getListData(this.$route.query):this.easyQuery({pageNum:0,keyword:""})},status:function(t,e){this.easyQuery({pageNum:0,status:this.status})}},beforeCreate:function(){var t=this.$route.query,e=t.pageNum,a=t.pageSize,n=t.status;Object.is(e,void 0)&&Object.is(a,void 0)&&Object.is(n,void 0)&&this.$router.replace({path:this.$route.path,query:{pageNum:0,pageSize:10,status:""}})},mounted:function(){this.getMemorys(),this.getListData(this.$route.query)},methods:{easyQuery:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.$route.query,a=Object.assign({},e,t);this.$router.push({path:this.$route.path,query:a})},changeCurrentPage:function(t){var e=t.pageNum;this.easyQuery({pageNum:e})},changeCurrentSize:function(t){var e=t.pageSize;this.easyQuery({pageNum:"0",pageSize:e})},refreshData:function(){this.getMemorys(),this.getListData(this.$route.query)},inputContent:r.a.throttle(function(){this.easyQuery({keyword:this.keyword,pageNum:0})},1e3,{leading:!1}),changeTabsItem:function(t){this.tabIndex=Number(t),this.keyword=""},getListData:function(t){var e=this;this.loading=!0;var a="",s="";0===this.tabIndex?(a=n.a,s=this.handleListData):1===this.tabIndex&&(a=n.b,s=this.handleListData1),a(Object.assign({},t)).then(function(t){if("200"===t.code){var a=e.sortListData(t.data),n=e.buildMachineList(a);s(a,n),e.machineTotalLabel="总数量",e.paganition={pageSize:parseInt(t.pageSize),currentPage:parseInt(t.pageNum)+1,total:parseInt(t.total)}}else"201"===t.code?(e.listData=[],e.newListData=[],e.machineTotalLabel="总数量"):(e.listData=[],e.machineTotalLabel="总数量",e.newListData=[],e.setToastData({message:t.message,type:"fail"}));e.loading=!1}).catch(function(){e.loading=!1})},getMemorys:function(){var t=this;Object(n.e)().then(function(e){t.memory=e.data}).catch(function(){t.loading=!1})},sortListData:function(t){return t.sort(function(t,e){return t.id>e.id?1:t.id<e.id?-1:0}),t},buildMachineList:function(t){var e=[];return t.forEach(function(t){var a=0;t.roles.forEach(function(t){a+=Number(t.frequency)}),e.push(a)}),e},handleListData:function(t,e){for(var a=t.length,n=[],s=0;s<a;s++){var r=t[s],i=r.roles.length;r.newMachine=[];for(var o=!0,l=0;l<i;l++){var c=r.roles[l],u=c.machines.length;if(u)for(var p=!0,h=0;h<u;h++)for(var d=c.machines[h],m=d.machine_id.split(","),g=d.machine_name.split(","),v=d.status.split(","),f=m.length,b=0;b<f;b++){var y={index:this.$route.query.pageSize*this.$route.query.pageNum+s+1,id:r.id,account:r.account,phone:r.phone,username:r.username,storeName:c.stores_name,storeId:c.stores_id,freeStorage:this.handleMemory(m[b]),machineNumber:c.frequency,machineItemCount:e[s],machineId:m[b],machineName:g[b],machineStatus:parseInt(v[b])};p?(p=!1,y.span=f):y.span=0,o?(o=!1,y.span1=e[s]):y.span1=0,n.push(y)}}}this.listData=n},handleMemory:function(t){for(var e=this.memory,a=e.length,n=0;n<a;n++)if(e[n].machine_id===t){var s=e[n].memory.split(",");return{top:s[0],cenBottom:s[1]}}},handleListData1:function(t,e){var a=[],n=!0,s=!1,r=void 0;try{for(var i,o=t[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var l=i.value,c=l.roles,p=!0,h=!1,d=void 0;try{for(var m,g=c[Symbol.iterator]();!(p=(m=g.next()).done);p=!0){var v=m.value,f=v.machines,b=!0,y=!1,_=void 0;try{for(var w,S=f[Symbol.iterator]();!(b=(w=S.next()).done);b=!0)for(var N=w.value,x=N.machine_id.split(","),D=N.status.split(","),I=N.machine_name.split(","),L=x.length,C=!0,$=0;$<L;$++){var k={index:this.$route.query.pageSize*this.$route.query.pageNum+$+1,userId:l.id,cityName:v.stores_city,storeId:v.stores_id,storeName:v.stores_name,freeStorage:this.handleMemory(x[$]),frequency:parseInt(v.frequency),machineId:x[$],machineName:I[$],machineStatus:parseInt(D[$])};C?(C=!1,k.span1=Number(v.frequency)):k.span1=0,a.push(k)}}catch(t){y=!0,_=t}finally{try{!b&&S.return&&S.return()}finally{if(y)throw _}}}}catch(t){h=!0,d=t}finally{try{!p&&g.return&&g.return()}finally{if(h)throw d}}}}catch(t){s=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(s)throw r}}var q={},M=[];a.forEach(function(t,e){var a=M.indexOf(t.cityName)+"";if("-1"===a){var n;M.push(t.cityName),n=M.length-1+"",q[n]=[],q[n].push(t)}else q[a].push(t)});var z=[],T=function(t){var e=q[t].length,a=!0;q[t].forEach(function(t){a?(a=!1,t.span=e):t.span=0,t.total=t.span}),z=[].concat(u(z),u(q[t]))};for(var j in q)T(j);this.newListData=z},setToastData:function(t){var e=this,a=t.message,n=t.type,s=t.callback;this.toastStatus=!0,this.$set(this.toastData,"message",a),this.$set(this.toastData,"type",n),setTimeout(function(){e.toastStatus=!1,s&&s()},1200)},objectSpanMethod:function(t){var e=t.row,a=(t.column,t.rowIndex,t.columnIndex);return a<4||9===a?e.span1>1?{rowspan:e.span1,colspan:1}:0===e.span1?{rowspan:0,colspan:0}:{rowspan:1,colspan:1}:a>=4&&a<5||8===a?e.span>1?{rowspan:e.span,colspan:1}:0===e.span?{rowspan:0,colspan:0}:{rowspan:1,colspan:1}:void 0},objectSpanMethod1:function(t){var e=t.row,a=(t.column,t.rowIndex,t.columnIndex);return a<2||7===a?e.span>1?{rowspan:e.span,colspan:1}:0===e.span?{rowspan:0,colspan:0}:{rowspan:1,colspan:1}:2===a||6===a?e.span1>1?{rowspan:e.span1,colspan:1}:0===e.span1?{rowspan:0,colspan:0}:{rowspan:1,colspan:1}:{rowspan:1,colspan:1}}}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("breadcrumb"),t._v(" "),a("div",{staticClass:"list"},[a("div",{staticClass:"list-header frsc list-header-special"},t._l(t.tabs,function(e,n){return a("div",{key:n,staticClass:"list-header-button",class:{active:n===t.tabIndex},on:{click:function(e){t.changeTabsItem(n)}}},[t._v(t._s(e.title))])})),t._v(" "),a("div",{staticClass:"list-header frsbc"},[a("div",{staticClass:"list-header-left"},[a("div",{staticClass:"list-header-select-container"},[a("el-select",{attrs:{placeholder:"状态"},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},t._l(t.statusOptions,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.status}})}))],1),t._v(" "),a("div",{staticClass:"list-header-input-container"},[a("el-input",{staticStyle:{width:"350px"},attrs:{placeholder:t.searchPlaceholder,"prefix-icon":"el-icon-search"},on:{input:t.inputContent},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1)]),t._v(" "),a("div",{staticClass:"list-header-right"},[t._m(0),t._v(" "),t._m(1),t._v(" "),a("div",{staticClass:"refresh-icon",on:{click:t.refreshData}},[t._v("\n          刷新\n        ")])])]),t._v(" "),a("div",{staticClass:"terminal-table-container"},[a("el-table",{directives:[{name:"show",rawName:"v-show",value:0===t.tabIndex,expression:"tabIndex === 0"},{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{"span-method":t.objectSpanMethod,data:t.listData,border:""}},[a("el-table-column",{attrs:{prop:"index",label:"序号",align:"center",width:"60"}}),t._v(" "),a("el-table-column",{attrs:{prop:"username",align:"center",label:"用户姓名"}}),t._v(" "),a("el-table-column",{ref:"account",attrs:{prop:"account",align:"center",label:"登录账号"}}),t._v(" "),a("el-table-column",{ref:"phone",attrs:{prop:"phone",align:"center",label:"绑定手机号码"}}),t._v(" "),a("el-table-column",{attrs:{prop:"storeName",align:"center",label:"门店"}}),t._v(" "),a("el-table-column",{attrs:{prop:"machineName",align:"center",label:"终端机"}}),t._v(" "),a("el-table-column",{attrs:{prop:"machineStatus",align:"center",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("span",{staticClass:"status-radius online",class:{outline:!t.row.machineStatus}})]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"freeStorage",align:"center",label:"内存余量（GB）"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[a("span",{class:{red:Number(e.row.freeStorage.top)<.48}},[t._v("上屏:"+t._s(e.row.freeStorage.top)+"；")]),t._v(" "),a("span",{class:{red:Number(e.row.freeStorage.cenBottom)<.48}},[t._v("中下屏:"+t._s(e.row.freeStorage.cenBottom))])])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"machineNumber",align:"center",label:"数量"}}),t._v(" "),a("el-table-column",{attrs:{prop:"machineItemCount",align:"center",label:t.machineTotalLabel}})],1),t._v(" "),a("el-table",{directives:[{name:"show",rawName:"v-show",value:1===t.tabIndex,expression:"tabIndex === 1"},{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.newListData,"empty-text":"终端机已分发完成","span-method":t.objectSpanMethod1,border:""}},[a("el-table-column",{attrs:{prop:"index",label:"序号",align:"center",width:"60"}}),t._v(" "),a("el-table-column",{attrs:{prop:"cityName",align:"center",label:"地区"}}),t._v(" "),a("el-table-column",{attrs:{prop:"storeName",align:"center",label:"门店"}}),t._v(" "),a("el-table-column",{attrs:{prop:"machineName",align:"center",label:"终端机"}}),t._v(" "),a("el-table-column",{attrs:{prop:"machineStatus",align:"center",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("span",{staticClass:"status-radius online",class:{outline:!t.row.machineStatus}})]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"freeStorage",align:"center",label:"内存余量（GB）"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[a("span",{class:{red:Number(e.row.freeStorage.top)<.48}},[t._v("上屏:"+t._s(e.row.freeStorage.top)+"；")]),t._v(" "),a("span",{class:{red:Number(e.row.freeStorage.cenBottom)<.48}},[t._v("中下屏:"+t._s(e.row.freeStorage.cenBottom))])])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"frequency",align:"center",label:"数量"}}),t._v(" "),a("el-table-column",{attrs:{prop:"total",align:"center",label:t.machineTotalLabel}})],1)],1),t._v(" "),t.listData.length||t.newListData.length?a("g-pagination",{attrs:{total:t.paganition.total,"page-size":t.paganition.pageSize,"current-page":t.paganition.currentPage},on:{changeCurrentPage:t.changeCurrentPage,changeCurrentSize:t.changeCurrentSize}}):t._e(),t._v(" "),t.toastStatus?a("toast",{attrs:{message:t.toastData.message,type:t.toastData.type}}):t._e()],1)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("span",{staticClass:"online-icon"}),this._v("\n          在线\n        ")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("span",{staticClass:"outline-icon"}),this._v("\n          离线\n        ")])}]};var d=a("VU/8")(p,h,!1,function(t){a("FsJi"),a("Gu+E")},"data-v-26cd7408",null);e.default=d.exports},FsJi:function(t,e){},"Gu+E":function(t,e){}});
//# sourceMappingURL=19.5854a3eae3bb92b3c8a2.js.map